<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Lojani</title>
<style>
    /* Universal Box-Sizing for better layout control */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    /* Shared Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      /* Use min-height to ensure it takes full height but can expand */
      background-color: #e0f2f7;
      overflow: auto;
      /* Allow body scroll if content is too large, but individual elements should manage their overflow */
    }

    .container {
      width: 90%;
      /* Use percentage for responsiveness */
      max-width: 450px;
      /* Set a max-width to prevent it from becoming too wide on large screens */
      background: #ffffff;
      border: none;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin: 20px auto;
      /* Add vertical margin for spacing */
      position: absolute;
      transition: all 0.5s ease-in-out;
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
    }

    .container.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
      position: relative;
      /* Make active container relative for normal flow */
    }

    .hidden {
      display: none;
    }

    h2 {
      color: #007bff;
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
      color: #333;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #cce7ee;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
      outline: none;
    }

    button {
      width: 100%;
      padding: 12px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 17px;
      font-weight: 600;
      margin-top: 10px;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
    }

    button:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3);
    }

    .link {
      display: block;
      text-align: center;
      margin-top: 20px;
      color: #007bff;
      cursor: pointer;
      font-size: 15px;
      transition: color 0.3s ease;
    }

    .link:hover {
      color: #0056b3;
      text-decoration: underline;
    }

    .messenger-container {
      margin-top: 25px;
      background-color: #f7f7f7;
      border-radius: 10px;
      padding: 15px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .messages {
      height: 250px;
      /* Fixed height with overflow */
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #fff;
      display: flex;
      flex-direction: column;
    }

    .message {
      margin-bottom: 15px;
      display: flex;
      align-items: flex-start;
      position: relative;
      animation: fadeInMessage 0.5s ease-out;
    }

    .profile-pic {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      border: 2px solid #eee;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .message-content {
      flex: 1;
      margin-left: 12px;
      background-color: #e6f7ff;
      padding: 10px 15px;
      border-radius: 15px 15px 15px 0px;
      max-width: 80%;
      position: relative;
      word-wrap: break-word;
    }

    .message span {
      font-weight: 600;
      color: #007bff;
      margin-right: 8px;
    }

    .message-time {
      color: #888;
      font-size: 0.75em;
      margin-left: 5px;
    }

    .message-text {
      margin: 5px 0 0 0;
      color: #333;
      line-height: 1.4;
    }

    .message.current-user .message-content {
      background-color: #dcf8c6;
      border-radius: 15px 15px 0px 15px;
      margin-left: auto;
      margin-right: 12px;
    }

    .message.current-user .profile-pic {
      order: 2;
      margin-left: 12px;
      margin-right: 0;
    }

    .message.current-user .message-header {
      justify-content: flex-end;
    }

    .message.current-user span {
      color: #28a745;
    }

    .typing-indicator {
      font-style: italic;
      color: #777;
      height: 20px;
      text-align: center;
      margin-bottom: 10px;
      animation: pulse 1.5s infinite ease-in-out;
    }

    #messageInput {
      margin-top: 10px;
      border-radius: 25px;
      padding-right: 50px;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalPopIn 0.3s ease-out forwards;
      /* forwards keeps the end state of the animation */
    }

    .modal.closing {
      animation: modalPopOut 0.3s ease-in forwards;
    }

    #warningModal,
    #banModal,
    #loginErrorModal,
    #spamWarningModal,
    #spamBanModal,
    #deleteAccountModal,
    #reportUserModal,
    #alertDialog,
    #addFakeUserModal,
    #searchUserModal,
    #changePasswordModal,
    #adminModeModal,
    #blockedUsersModal,
    #forgotPasswordModal,
    #deleteDataModal { /* Added deleteDataModal */
      text-align: center;
    }

    #warningModal h2,
    #banModal h2,
    #loginErrorModal h2,
    #spamWarningModal h2,
    #spamBanModal h2,
    #deleteAccountModal h2,
    #reportUserModal h2 {
      color: #d9534f;
    }

    #alertDialog h2,
    #addFakeUserModal h2,
    #searchUserModal h2,
    #changePasswordModal h2,
    #adminModeModal h2,
    #blockedUsersModal h2,
    #forgotPasswordModal h2,
    #deleteDataModal h2 { /* Added deleteDataModal */
      color: #007bff;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 999;
      animation: fadeInOverlay 0.3s ease-out;
    }

    .profile-info {
      margin-top: 15px;
    }

    .profile-info label {
      font-weight: bold;
    }

    .warning-button {
      background-color: #d9534f;
      margin-top: 10px;
    }

    .warning-button:hover {
      background-color: #c9302c;
    }

    .delete-button {
      background-color: #dc3545;
      margin-top: 15px;
    }

    .delete-button:hover {
      background-color: #c82333;
    }

    #deleteAccountModal .form-group {
      text-align: left;
      margin: 15px 0;
    }

    #deleteAccountModal input {
      width: 100%;
    }

    /* Message Options Dropdown */
    .message-options {
      position: absolute;
      top: 5px;
      right: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .message-options-dropdown {
      position: absolute;
      top: 25px;
      right: 0;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 10;
      min-width: 120px;
    }

    .message-options-dropdown button {
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      padding: 8px 10px;
      cursor: pointer;
      color: #333;
    }

    .message-options-dropdown button:hover {
      background-color: #f0f0f0;
    }

    /* Keyframe Animations */
    @keyframes fadeInMessage {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% {
        opacity: 0.7;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: 0.7;
      }
    }

    @keyframes modalPopIn {
      from {
        opacity: 0;
        transform: translate(-50%, -40%) scale(0.9);
      }

      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    @keyframes modalPopOut {
      from {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      to {
        opacity: 0;
        transform: translate(-50%, -60%) scale(0.9);
      }
    }

    @keyframes fadeInOverlay {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* Adjustments for profile info */
    .profile-info h3 {
      color: #007bff;
      margin-top: 25px;
      margin-bottom: 15px;
      text-align: center;
    }

    .profile-info label {
      font-weight: 600;
      color: #555;
      margin-top: 10px;
      display: block;
    }

    .profile-info p {
      margin: 5px 0 15px 0;
      color: #666;
      padding-left: 10px;
      border-left: 3px solid #eee;
    }

    /* Custom scrollbar (Webkit browsers) */
    .messages::-webkit-scrollbar {
      width: 8px;
    }

    .messages::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .messages::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }

    .messages::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    #searchResults {
      text-align: left;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .search-result-item {
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin-bottom: 10px;
      background-color: #f9f9f9;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .search-result-item:hover {
      background-color: #eaf6fc;
    }

    .search-result-item h4 {
      margin: 0 0 5px 0;
      color: #007bff;
    }

    .search-result-item p {
      margin: 0;
      color: #555;
      font-size: 0.9em;
    }

    #blockedUsersList {
      text-align: left;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .blocked-user-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin-bottom: 10px;
      background-color: #f9f9f9;
    }

    .blocked-user-item span {
      font-weight: 600;
      color: #333;
    }

    .blocked-user-item button {
      width: auto;
      padding: 5px 10px;
      margin: 0;
      font-size: 0.9em;
    }

    /* Styles for code snippets in modals */
    #deleteDataModal code {
        display: block;
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        text-align: left;
        white-space: pre-wrap; /* Ensures long lines wrap */
        word-break: break-all; /* Breaks words if necessary */
    }
  </style>
</head>
<body>
<div class="container" id="loginScreen">
<h2>Login</h2>
<div class="form-group">
<label for="loginUsername">Username</label>
<input id="loginUsername" placeholder="Enter your username" type="text"/>
</div>
<div class="form-group">
<label for="loginPassword">Password</label>
<input id="loginPassword" placeholder="Enter your password" type="password"/>
</div>
<button onclick="login()">Login</button>
<div class="link" onclick="showForgotPassword()">Forgot Password?</div>
<div class="link" onclick="showCreateAccount()">Create an account</div>
</div>
<div class="container hidden" id="createAccountScreen">
<h2>Create Account</h2>
<div class="form-group">
<label for="createUsername">Username</label>
<input id="createUsername" placeholder="Choose a username" type="text"/>
</div>
<div class="form-group">
<label for="createPassword">Password</label>
<input id="createPassword" placeholder="Choose a password" type="password"/>
</div>
<!-- Security Question Fields Start -->
<div class="form-group">
<label for="securityQuestion">Security Question</label>
<input id="securityQuestion" placeholder="e.g., What is your mother's maiden name?" type="text"/>
</div>
<div class="form-group">
<label for="securityAnswer">Security Answer</label>
<input id="securityAnswer" placeholder="Enter your answer" type="password"/>
</div>
<!-- Security Question Fields End -->
<div class="form-group">
<input id="agreeCheckbox" type="checkbox"/>
<label for="agreeCheckbox">I agree to the <a href="javascript:void(0)" onclick="showTermsAndConditions()">Terms and Conditions</a></label>
</div>

<!-- Captcha Section -->
<div class="form-group">
<label for="captchaInput">Captcha</label>
<div style="display:flex; align-items:center; gap:10px;">
<span id="captchaCode" style="font-weight:bold; font-size:18px; background:#f0f0f0; padding:5px 10px; border-radius:5px;"></span>
<button onclick="generateCaptcha()" type="button">â†»</button>
</div>
<input id="captchaInput" placeholder="Enter captcha code" type="text"/>
</div>
<button onclick="createAccount()">Create Account</button>
<div class="link" onclick="showLogin()">Already have an account? Login</div>
</div>
<div class="container hidden" id="messengerScreen">
<h2>Welcome, <span id="currentUser"></span>!</h2>
<button onclick="logout()">Logout</button>
<div class="messenger-container">
<div class="messages" id="messages"></div>
<div class="typing-indicator" id="typingIndicator"></div>
<input id="messageInput" onblur="hideTypingIndicator()" oninput="showTypingIndicator()" placeholder="Type a message..." type="text"/>
<button onclick="sendMessage()">Send</button>
<input id="fileInput" type="file"/>
<button onclick="sendFile()">Send File</button>
</div>
<button onclick="openSettings()">Settings</button>
<button onclick="openSearchUserModal()">Search User</button>
<button onclick="openBlockedUsersModal()">Blocked Users</button> <div>
<select id="userSelect" onchange="switchUser()">
<option value="">Select User</option>
</select>
</div>
<div class="profile-info">
<h3>Profile</h3>
<div>
<label>About Me:</label>
<p id="aboutMeText">No bio set.</p>
<label>Country:</label>
<p id="countryText">No country selected.</p>
<label>Join Date:</label>
<p id="joinDateText">Not available.</p>
</div>
</div>
</div>
<div id="overlay"></div>
<div class="modal" id="settingsModal">
<h2>Settings</h2>
<label for="changeName">Change Username:</label>
<input id="changeName" placeholder="Enter new name" type="text"/>
<label for="aboutMeInput">About Me:</label>
<textarea id="aboutMeInput" placeholder="Enter a short bio..."></textarea>
<label for="profilePicInput">Change Profile Picture:</label>
<input accept="image/*" id="profilePicInput" type="file"/>
<label for="countrySelect">Select Your Country:</label>
<select id="countrySelect">
<option value="">Select Country</option>
<option value="Afghanistan">ğŸ‡¦ğŸ‡« Afghanistan</option>
<option value="Ã…land Islands">ğŸ‡¦ğŸ‡½ Ã…land Islands</option>
<option value="Albania">ğŸ‡¦ğŸ‡± Albania</option>
<option value="Algeria">ğŸ‡©ğŸ‡¿ Algeria</option>
<option value="American Samoa">ğŸ‡¦ğŸ‡¸ American Samoa</option>
<option value="Andorra">ğŸ‡¦ğŸ‡© Andorra</option>
<option value="Angola">ğŸ‡¦ğŸ‡´ Angola</option>
<option value="Anguilla">ğŸ‡¦ğŸ‡® Anguilla</option>
<option value="Antarctica">ğŸ‡¦ğŸ‡¶ Antarctica</option>
<option value="Antigua and Barbuda">ğŸ‡¦ğŸ‡¬ Antigua and Barbuda</option>
<option value="Argentina">ğŸ‡¦ğŸ‡· Argentina</option>
<option value="Armenia">ğŸ‡¦ğŸ‡² Armenia</option>
<option value="Aruba">ğŸ‡¦ğŸ‡¼ Aruba</option>
<option value="Australia">ğŸ‡¦ğŸ‡º Australia</option>
<option value="Austria">ğŸ‡¦ğŸ‡¹ Austria</option>
<option value="Azerbaijan">ğŸ‡¦ğŸ‡¿ Azerbaijan</option>
<option value="Bahamas">ğŸ‡§ğŸ‡¸ Bahamas</option>
<option value="Bahrain">ğŸ‡§ğŸ‡­ Bahrain</option>
<option value="Bangladesh">ğŸ‡§ğŸ‡© Bangladesh</option>
<option value="Barbados">ğŸ‡§ğŸ‡§ Barbados</option>
<option value="Belarus">ğŸ‡§ğŸ‡¾ Belarus</option>
<option value="Belgium">ğŸ‡§ğŸ‡ª Belgium</option>
<option value="Belize">ğŸ‡§ğŸ‡¿ Belize</option>
<option value="Benin">ğŸ‡§ğŸ‡¯ Benin</option>
<option value="Bermuda">ğŸ‡§ğŸ‡² Bermuda</option>
<option value="Bhutan">ğŸ‡§ğŸ‡¹ Bhutan</option>
<option value="Bolivia">ğŸ‡§ğŸ‡´ Bolivia</option>
<option value="Bosnia and Herzegovina">ğŸ‡§ğŸ‡¦ Bosnia and Herzegovina</option>
<option value="Botswana">ğŸ‡§ğŸ‡¼ Botswana</option>
<option value="Brazil">ğŸ‡§ğŸ‡· Brazil</option>
<option value="British Indian Ocean Territory">ğŸ‡®ğŸ‡´ British Indian Ocean Territory</option>
<option value="British Virgin Islands">ğŸ‡»ğŸ‡¬ British Virgin Islands</option>
<option value="Brunei">ğŸ‡§ğŸ‡³ Brunei</option>
<option value="Bulgaria">ğŸ‡§ğŸ‡¬ Bulgaria</option>
<option value="Burkina Faso">ğŸ‡§ğŸ‡« Burkina Faso</option>
<option value="Burundi">ğŸ‡§ğŸ‡® Burundi</option>
<option value="Cambodia">ğŸ‡°ğŸ‡­ Cambodia</option>
<option value="Cameroon">ğŸ‡¨ğŸ‡² Cameroon</option>
<option value="Canada">ğŸ‡¨ğŸ‡¦ Canada</option>
<option value="Cabo Verde">ğŸ‡¨ğŸ‡» Cabo Verde</option>
<option value="Cayman Islands">ğŸ‡°ğŸ‡¾ Cayman Islands</option>
<option value="Caribbean Netherlands">ğŸ‡§ğŸ‡¶ Caribbean Netherlands</option>
<option value="Central African Republic">ğŸ‡¨ğŸ‡« Central African Republic</option>
<option value="Chad">ğŸ‡¹ğŸ‡© Chad</option>
<option value="Chile">ğŸ‡¨ğŸ‡± Chile</option>
<option value="China">ğŸ‡¨ğŸ‡³ China</option>
<option value="Christmas Island">ğŸ‡¨ğŸ‡½ Christmas Island</option>
<option value="Cocos Islands">ğŸ‡¨ğŸ‡¨ Cocos (Keeling) Islands</option>
<option value="Colombia">ğŸ‡¨ğŸ‡´ Colombia</option>
<option value="Comoros">ğŸ‡°ğŸ‡² Comoros</option>
<option value="Congo">ğŸ‡¨ğŸ‡¬ Congo</option>
<option value="Democratic Republic of the Congo">ğŸ‡¨ğŸ‡© Democratic Republic of the Congo</option>
<option value="Cook Islands">ğŸ‡¨ğŸ‡° Cook Islands</option>
<option value="Costa Rica">ğŸ‡¨ğŸ‡· Costa Rica</option>
<option value="Croatia">ğŸ‡­ğŸ‡· Croatia</option>
<option value="Cuba">ğŸ‡¨ğŸ‡º Cuba</option>
<option value="Curacao">ğŸ‡¨ğŸ‡¼ Curacao</option>
<option value="Cyprus">ğŸ‡¨ğŸ‡¾ Cyprus</option>
<option value="Czech Republic">ğŸ‡¨ğŸ‡¿ Czech Republic</option>
<option value="Denmark">ğŸ‡©ğŸ‡° Denmark</option>
<option value="Djibouti">ğŸ‡©ğŸ‡¯ Djibouti</option>
<option value="Dominica">ğŸ‡©ğŸ‡² Dominica</option>
<option value="Dominican Republic">ğŸ‡©ğŸ‡´ Dominican Republic</option>
<option value="Ecuador">ğŸ‡ªğŸ‡¨ Ecuador</option>
<option value="Egypt">ğŸ‡ªğŸ‡¬ Egypt</option>
<option value="El Salvador">ğŸ‡¸ğŸ‡» El Salvador</option>
<option value="Equatorial Guinea">ğŸ‡¬ğŸ‡¶ Equatorial Guinea</option>
<option value="Eritrea">ğŸ‡ªğŸ‡· Eritrea</option>
<option value="Estonia">ğŸ‡ªğŸ‡ª Estonia</option>
<option value="Ethiopia">ğŸ‡ªğŸ‡¹ Ethiopia</option>
<option value="Falkland Islands">ğŸ‡«ğŸ‡° Falkland Islands</option>
<option value="Faroe Islands">ğŸ‡«ğŸ‡´ Faroe Islands</option>
<option value="Fiji">ğŸ‡«ğŸ‡¯ Fiji</option>
<option value="Finland">ğŸ‡«ğŸ‡® Finland</option>
<option value="France">ğŸ‡«ğŸ‡· France</option>
<option value="French Guiana">ğŸ‡¬ğŸ‡« French Guiana</option>
<option value="French Polynesia">ğŸ‡µğŸ‡« French Polynesia</option>
<option value="French Southern Territories">ğŸ‡¹ğŸ‡« French Southern Territories</option>
<option value="Gabon">ğŸ‡¬ğŸ‡¦ Gabon</option>
<option value="Gambia">ğŸ‡¬ğŸ‡² Gambia</option>
<option value="Georgia">ğŸ‡¬ğŸ‡ª Georgia</option>
<option value="Germany">ğŸ‡©ğŸ‡ª Germany</option>
<option value="Ghana">ğŸ‡¬ğŸ‡­ Ghana</option>
<option value="Gibraltar">ğŸ‡¬ğŸ‡® Gibraltar</option>
<option value="Greece">ğŸ‡¬ğŸ‡· Greece</option>
<option value="Greenland">ğŸ‡¬ğŸ‡± Greenland</option>
<option value="Grenada">ğŸ‡¬ğŸ‡© Grenada</option>
<option value="Guadeloupe">ğŸ‡¬ğŸ‡µ Guadeloupe</option>
<option value="Guam">ğŸ‡¬ğŸ‡º Guam</option>
<option value="Guatemala">ğŸ‡¬ğŸ‡¹ Guatemala</option>
<option value="Guernsey">ğŸ‡¬ğŸ‡¬ Guernsey</option>
<option value="Guinea">ğŸ‡¬ğŸ‡³ Guinea</option>
<option value="Guinea-Bissau">ğŸ‡¬ğŸ‡¼ Guinea-Bissau</option>
<option value="Guyana">ğŸ‡¬ğŸ‡¾ Guyana</option>
<option value="Haiti">ğŸ‡­ğŸ‡¹ Haiti</option>
<option value="Honduras">ğŸ‡­ğŸ‡³ Honduras</option>
<option value="Hong Kong">ğŸ‡­ğŸ‡° Hong Kong</option>
<option value="Hungary">ğŸ‡­ğŸ‡º Hungary</option>
<option value="Iceland">ğŸ‡®ğŸ‡¸ Iceland</option>
<option value="India">ğŸ‡®ğŸ‡³ India</option>
<option value="Indonesia">ğŸ‡®ğŸ‡© Indonesia</option>
<option value="Iran">ğŸ‡®ğŸ‡· Iran</option>
<option value="Iraq">ğŸ‡®ğŸ‡¶ Iraq</option>
<option value="Ireland">ğŸ‡®ğŸ‡ª Ireland</option>
<option value="Isle of Man">ğŸ‡®ğŸ‡² Isle of Man</option>
<option value="Israel">ğŸ‡®ğŸ‡± Israel</option>
<option value="Italy">ğŸ‡®ğŸ‡¹ Italy</option>
<option value="Jamaica">ğŸ‡¯ğŸ‡² Jamaica</option>
<option value="Japan">ğŸ‡¯ğŸ‡µ Japan</option>
<option value="Jersey">ğŸ‡¯ğŸ‡ª Jersey</option>
<option value="Jordan">ğŸ‡¯ğŸ‡´ Jordan</option>
<option value="Kazakhstan">ğŸ‡°ğŸ‡¿ Kazakhstan</option>
<option value="Kenya">ğŸ‡°ğŸ‡ª Kenya</option>
<option value="Kiribati">ğŸ‡°ğŸ‡® Kiribati</option>
<option value="Kosovo">ğŸ‡½ğŸ‡° Kosovo</option>
<option value="Kuwait">ğŸ‡°ğŸ‡¼ Kuwait</option>
<option value="Kyrgyzstan">ğŸ‡°ğŸ‡¬ Kyrgyzstan</option>
<option value="Laos">ğŸ‡±ğŸ‡¦ Laos</option>
<option value="Latvia">ğŸ‡±ğŸ‡» Latvia</option>
<option value="Lebanon">ğŸ‡±ğŸ‡§ Lebanon</option>
<option value="Lesotho">ğŸ‡±ğŸ‡¸ Lesotho</option>
<option value="Liberia">ğŸ‡±ğŸ‡· Liberia</option>
<option value="Libya">ğŸ‡±ğŸ‡¾ Libya</option>
<option value="Liechtenstein">ğŸ‡±ğŸ‡® Liechtenstein</option>
<option value="Lithuania">ğŸ‡±ğŸ‡¹ Lithuania</option>
<option value="Luxembourg">ğŸ‡±ğŸ‡º Luxembourg</option>
<option value="Macau">ğŸ‡²ğŸ‡´ Macau</option>
<option value="Madagascar">ğŸ‡²ğŸ‡¬ Madagascar</option>
<option value="Malawi">ğŸ‡²ğŸ‡¼ Malawi</option>
<option value="Malaysia">ğŸ‡²ğŸ‡¾ Malaysia</option>
<option value="Maldives">ğŸ‡²ğŸ‡» Maldives</option>
<option value="Mali">ğŸ‡²ğŸ‡± Mali</option>
<option value="Malta">ğŸ‡²ğŸ‡¹ Malta</option>
<option value="Marshall Islands">ğŸ‡²ğŸ‡­ Marshall Islands</option>
<option value="Martinique">ğŸ‡²ğŸ‡¶ Martinique</option>
<option value="Mauritania">ğŸ‡²ğŸ‡· Mauritania</option>
<option value="Mauritius">ğŸ‡²ğŸ‡º Mauritius</option>
<option value="Mayotte">ğŸ‡¾ğŸ‡¹ Mayotte</option>
<option value="Mexico">ğŸ‡²ğŸ‡½ Mexico</option>
<option value="Micronesia">ğŸ‡«ğŸ‡² Micronesia</option>
<option value="Moldova">ğŸ‡²ğŸ‡© Moldova</option>
<option value="Monaco">ğŸ‡²ğŸ‡¨ Monaco</option>
<option value="Mongolia">ğŸ‡²ğŸ‡³ Mongolia</option>
<option value="Montenegro">ğŸ‡²ğŸ‡ª Montenegro</option>
<option value="Montserrat">ğŸ‡²ğŸ‡¸ Montserrat</option>
<option value="Morocco">ğŸ‡²ğŸ‡¦ Morocco</option>
<option value="Mozambique">ğŸ‡²ğŸ‡¿ Mozambique</option>
<option value="Myanmar">ğŸ‡²ğŸ‡² Myanmar</option>
<option value="Namibia">ğŸ‡³ğŸ‡¦ Namibia</option>
<option value="Nauru">ğŸ‡³ğŸ‡· Nauru</option>
<option value="Nepal">ğŸ‡³ğŸ‡µ Nepal</option>
<option value="Netherlands">ğŸ‡³ğŸ‡± Netherlands</option>
<option value="New Caledonia">ğŸ‡³ğŸ‡¨ New Caledonia</option>
<option value="New Zealand">ğŸ‡³ğŸ‡¿ New Zealand</option>
<option value="Nicaragua">ğŸ‡³ğŸ‡® Nicaragua</option>
<option value="Niger">ğŸ‡³ğŸ‡ª Niger</option>
<option value="Nigeria">ğŸ‡³ğŸ‡¬ Nigeria</option>
<option value="Niue">ğŸ‡³ğŸ‡º Niue</option>
<option value="Norfolk Island">ğŸ‡³ğŸ‡« Norfolk Island</option>
<option value="North Korea">ğŸ‡°ğŸ‡µ North Korea</option>
<option value="North Macedonia">ğŸ‡²ğŸ‡° North Macedonia</option>
<option value="Northern Mariana Islands">ğŸ‡²ğŸ‡µ Northern Mariana Islands</option>
<option value="Norway">ğŸ‡³ğŸ‡´ Norway</option>
<option value="Oman">ğŸ‡´ğŸ‡² Oman</option>
<option value="Pakistan">ğŸ‡µğŸ‡° Pakistan</option>
<option value="Palau">ğŸ‡µğŸ‡¼ Palau</option>
<option value="Palestine">ğŸ‡µğŸ‡¸ Palestine</option>
<option value="Panama">ğŸ‡µğŸ‡¦ Panama</option>
<option value="Papua New Guinea">ğŸ‡µğŸ‡¬ Papua New Guinea</option>
<option value="Paraguay">ğŸ‡µğŸ‡¾ Paraguay</option>
<option value="Peru">ğŸ‡µğŸ‡ª Peru</option>
<option value="Philippines">ğŸ‡µğŸ‡­ Philippines</option>
<option value="Pitcairn Islands">ğŸ‡µğŸ‡³ Pitcairn Islands</option>
<option value="Poland">ğŸ‡µğŸ‡± Poland</option>
<option value="Portugal">ğŸ‡µğŸ‡¹ Portugal</option>
<option value="Puerto Rico">ğŸ‡µğŸ‡· Puerto Rico</option>
<option value="Qatar">ğŸ‡¶ğŸ‡¦ Qatar</option>
<option value="Romania">ğŸ‡·ğŸ‡´ Romania</option>
<option value="Russia">ğŸ‡·ğŸ‡º Russia</option>
<option value="Rwanda">ğŸ‡·ğŸ‡¼ Rwanda</option>
<option value="RÃ©union">ğŸ‡·ğŸ‡ª RÃ©union</option>
<option value="Saint Barthelemy">ğŸ‡§ğŸ‡± Saint Barthelemy</option>
<option value="Saint Helena">ğŸ‡¸ğŸ‡­ Saint Helena</option>
<option value="Saint Kitts and Nevis">ğŸ‡°ğŸ‡³ Saint Kitts and Nevis</option>
<option value="Saint Lucia">ğŸ‡±ğŸ‡¨ Saint Lucia</option>
<option value="Saint Martin">ğŸ‡²ğŸ‡« Saint Martin</option>
<option value="Saint Pierre and Miquelon">ğŸ‡µğŸ‡² Saint Pierre and Miquelon</option>
<option value="Saint Vincent and the Grenadines">ğŸ‡»ğŸ‡¨ Saint Vincent and the Grenadines</option>
<option value="Samoa">ğŸ‡¼ğŸ‡¸ Samoa</option>
<option value="San Marino">ğŸ‡¸ğŸ‡² San Marino</option>
<option value="Sao Tome and Principe">ğŸ‡¸ğŸ‡¹ Sao Tome and Principe</option>
<option value="Saudi Arabia">ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
<option value="Senegal">ğŸ‡¸ğŸ‡³ Senegal</option>
<option value="Serbia">ğŸ‡·ğŸ‡¸ Serbia</option>
<option value="Seychelles">ğŸ‡¸ğŸ‡¨ Seychelles</option>
<option value="Sierra Leone">ğŸ‡¸ğŸ‡± Sierra Leone</option>
<option value="Singapore">ğŸ‡¸ğŸ‡¬ Singapore</option>
<option value="Sint Maarten">ğŸ‡¸ğŸ‡½ Sint Maarten</option>
<option value="Slovakia">ğŸ‡¸ğŸ‡° Slovakia</option>
<option value="Slovenia">ğŸ‡¸ğŸ‡® Slovenia</option>
<option value="Solomon Islands">ğŸ‡¸ğŸ‡§ Solomon Islands</option>
<option value="Somalia">ğŸ‡¸ğŸ‡´ Somalia</option>
<option value="Somaliland">ğŸ‡¸ğŸ‡´ Somaliland</option>
<option value="South Africa">ğŸ‡¿ğŸ‡¦ South Africa</option>
<option value="South Georgia and the South Sandwich Islands">ğŸ‡¬ğŸ‡¸ South Georgia and the South Sandwich Islands</option>
<option value="South Korea">ğŸ‡°ğŸ‡· South Korea</option>
<option value="South Sudan">ğŸ‡¸ğŸ‡¸ South Sudan</option>
<option value="Spain">ğŸ‡ªğŸ‡¸ Spain</option>
<option value="Sri Lanka">ğŸ‡±ğŸ‡° Sri Lanka</option>
<option value="Sudan">ğŸ‡¸ğŸ‡© Sudan</option>
<option value="Suriname">ğŸ‡¸ğŸ‡· Suriname</option>
<option value="Svalbard and Jan Mayen">ğŸ‡¸ğŸ‡¯ Svalbard and Jan Mayen</option>
<option value="Sweden">ğŸ‡¸ğŸ‡ª Sweden</option>
<option value="Switzerland">ğŸ‡¨ğŸ‡­ Switzerland</option>
<option value="Syria">ğŸ‡¸ğŸ‡¾ Syria</option>
<option value="Taiwan">ğŸ‡¹ğŸ‡¼ Taiwan</option>
<option value="Tajikistan">ğŸ‡¹ğŸ‡¯ Tajikistan</option>
<option value="Tanzania">ğŸ‡¹ğŸ‡¿ Tanzania</option>
<option value="Thailand">ğŸ‡¹ğŸ‡­ Thailand</option>
<option value="Timor-Leste">ğŸ‡¹ğŸ‡± Timor-Leste</option>
<option value="Togo">ğŸ‡¹ğŸ‡¬ Togo</option>
<option value="Tokelau">ğŸ‡¹ğŸ‡° Tokelau</option>
<option value="Tonga">ğŸ‡¹ğŸ‡´ Tonga</option>
<option value="Trinidad and Tobago">ğŸ‡¹ğŸ‡¹ Trinidad and Tobago</option>
<option value="Tunisia">ğŸ‡¹ğŸ‡³ Tunisia</option>
<option value="Turkey">ğŸ‡¹ğŸ‡· Turkey</option>
<option value="Turkmenistan">ğŸ‡¹ğŸ‡² Turkmenistan</option>
<option value="Turks and Caicos Islands">ğŸ‡¹ğŸ‡¨ Turks and Caicos Islands</option>
<option value="Tuvalu">ğŸ‡¹ğŸ‡» Tuvalu</option>
<option value="Uganda">ğŸ‡ºğŸ‡¬ Uganda</option>
<option value="Ukraine">ğŸ‡ºğŸ‡¦ Ukraine</option>
<option value="United Arab Emirates">ğŸ‡¦ğŸ‡ª United Arab Emirates</option>
<option value="United Kingdom">ğŸ‡¬ğŸ‡§ United Kingdom</option>
<option value="United States">ğŸ‡ºğŸ‡¸ United States</option>
<option value="Uruguay">ğŸ‡ºğŸ‡¾ Uruguay</option>
<option value="Uzbekistan">ğŸ‡ºğŸ‡¿ Uzbekistan</option>
<option value="Vanuatu">ğŸ‡»ğŸ‡º Vanuatu</option>
<option value="Vatican City">ğŸ‡»ğŸ‡¦ Vatican City</option>
<option value="Venezuela">ğŸ‡»ğŸ‡ª Venezuela</option>
<option value="Vietnam">ğŸ‡»ğŸ‡³ Vietnam</option>
<option value="Wallis and Futuna">ğŸ‡¼ğŸ‡« Wallis and Futuna</option>
<option value="Western Sahara">ğŸ‡ªğŸ‡­ Western Sahara</option>
<option value="Yemen">ğŸ‡¾ğŸ‡ª Yemen</option>
<option value="Zambia">ğŸ‡¿ğŸ‡² Zambia</option>
<option value="Zimbabwe">ğŸ‡¿ğŸ‡¼ Zimbabwe</option>
</select>
<label for="joinDateInput">Change Join Date:</label>
<input id="joinDateInput" type="date"/>
<button onclick="saveSettings()">Save</button>
<button onclick="showChangePasswordModal()">Change Password</button>
<button onclick="toggleAdminMode()">Admin Account Mode</button>
<button onclick="closeSettings()">Close</button>
<button class="delete-button" onclick="showDeleteAccountModal()">Delete Account</button>
<button onclick="showDeleteDataModal()">How to delete Lojani data</button> <!-- New button added here -->
<hr style="margin: 20px 0;"/>
<h3>ğŸ“¦ Backup &amp; Restore</h3>
<button onclick="downloadBackup()">Download Backup</button><br/><br/>
<label for="restoreInput"><strong>Restore Backup:</strong></label><br/>
<input accept=".json" id="restoreInput" type="file"/>
<button onclick="restoreBackup()">Restore</button>
</div>
<div class="modal" id="deleteAccountModal">
<h2>ğŸ—‘ï¸ Delete Account</h2>
<p><strong>Are you SURE that you want to delete your account?</strong></p>
<p>This is permanent and the account cannot be restored.</p>
<div class="form-group">
<label for="deletePasswordInput">Type your password below to confirm that it's you:</label>
<input id="deletePasswordInput" placeholder="Enter your password" type="password"/>
</div>
<button class="warning-button" onclick="deleteAccount()">Delete</button>
<button onclick="closeDeleteAccountModal()">Cancel</button>
</div>
<!-- New Modal for Delete Data Instructions -->
<div class="modal hidden" id="deleteDataModal">
<h2>How to Delete Lojani Data</h2>
<p>To delete all Lojani data stored in your browser, you need to execute these 3 commands in the console.</p>
<p>You can access the console by right-clicking on the page, selecting "Inspect", and then clicking on the "Console" tab.</p>
<p>Commands:</p>
<code>localStorage.clear();</code>
<code>sessionStorage.clear();</code>
<code>document.cookie.split(";").forEach(function(cookie) {
    const eqPos = cookie.indexOf("=");
    const name = eqPos &gt; -1 ? cookie.substring(0, eqPos) : cookie;
    document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
});</code>
<button onclick="closeDeleteDataModal()">Close</button>
</div>
<div class="modal hidden" id="changePasswordModal">
<h2>Change Password</h2>
<div class="form-group">
<label for="currentPassword">Current Password:</label>
<input id="currentPassword" type="password"/>
</div>
<div class="form-group">
<label for="newPassword">New Password:</label>
<input id="newPassword" type="password"/>
</div>
<div class="form-group">
<label for="confirmNewPassword">Confirm New Password:</label>
<input id="confirmNewPassword" type="password"/>
</div>
<button onclick="saveNewPassword()">Save Password</button>
<button onclick="closeChangePasswordModal()">Cancel</button>
</div>
<div class="modal hidden" id="forgotPasswordModal">
<h2>Forgot Password</h2>
<div class="form-group">
<label for="forgotPasswordUsername">Enter your username:</label>
<input id="forgotPasswordUsername" placeholder="Enter your username" type="text"/>
</div>
<!-- Security Question Fields for Forgot Password Start -->
<div class="form-group">
<label for="forgotSecurityQuestion">Security Question</label>
<input id="forgotSecurityQuestion" placeholder="Enter the security question" type="text"/>
</div>
<div class="form-group">
<label for="forgotSecurityAnswer">Security Answer</label>
<input id="forgotSecurityAnswer" placeholder="Enter your answer" type="password"/>
</div>
<!-- Security Question Fields for Forgot Password End -->
<p id="retrievedPassword" style="font-weight: bold; color: #333; margin-top: 15px;"></p>
<button onclick="showPassword()">Show Password</button>
<button onclick="closeForgotPasswordModal()">Close</button>
</div>
<div class="modal" id="warningModal">
<h2>âš ï¸ Warning!</h2>
<p>You have used inappropriate language 5 times.</p>
<p>Continued use of banned words may result in account suspension.</p>
<label>
<input id="warningCheckbox" type="checkbox"/> I understand and agree to follow the community guidelines
    </label>
<button class="warning-button" disabled="" id="acknowledgeButton" onclick="acknowledgeWarning()">Continue</button>
</div>
<div class="modal" id="banModal">
<h2>ğŸš« Account Banned</h2>
<p>Your account has been permanently banned due to repeated violations of our community guidelines.</p>
<p>You have used inappropriate language 15 or more times.</p>
<button class="warning-button" onclick="logout()">Logout</button>
</div>
<div class="modal" id="spamWarningModal">
<h2>âš ï¸ Spam Warning!</h2>
<p>You have been detected spamming the same words repeatedly.</p>
<p>Continued spamming may result in account suspension.</p>
<label>
<input id="spamWarningCheckbox" type="checkbox"/> I understand and agree to stop spamming
    </label>
<button class="warning-button" disabled="" id="acknowledgeSpamButton" onclick="acknowledgeSpamWarning()">Continue</button>
</div>
<div class="modal" id="spamBanModal">
<h2>ğŸš« Account Banned for Spamming</h2>
<p>Your account has been permanently banned due to excessive spamming.</p>
<p>You have repeatedly sent the same words despite warnings.</p>
<button class="warning-button" onclick="logout()">Logout</button>
</div>
<div class="modal" id="loginErrorModal">
<h2>âš ï¸ Login Error</h2>
<p id="loginErrorMessage">This account has been banned and cannot be accessed.</p>
<button class="warning-button" onclick="closeLoginErrorModal()">Close</button>
</div>
<div class="modal hidden" id="editMessageModal">
<h2>âœï¸ Edit Message</h2>
<div class="form-group">
<label for="editMessageInput">Edit your message:</label>
<textarea id="editMessageInput"></textarea>
</div>
<button onclick="saveEditedMessage()">Save Changes</button>
<button onclick="closeEditMessageModal()">Cancel</button>
</div>
<div class="modal hidden" id="reportUserModal">
<h2>ğŸš¨ Report User</h2>
<p>Are you sure you want to report <span id="reportedUsername"></span>?</p>
<div class="form-group">
<label for="reportReasonDropdown">Reason for reporting:</label>
<select id="reportReasonDropdown">
<option value="">Select a reason</option>
<option value="Bullying">Bullying</option>
<option value="Swearing">Swearing</option>
<option value="Spamming">Spamming</option>
<option value="Harassment">Harassment</option>
<option value="Hate Speech">Hate Speech</option>
<option value="Inappropriate Content">Inappropriate Content</option>
<option value="Other">Other</option>
</select>
</div>
<div class="form-group">
<label for="reportReason">Additional details (optional):</label>
<textarea id="reportReason" placeholder="Describe the issue..."></textarea>
</div>
<button onclick="confirmReportUser()">Report</button>
<button onclick="closeReportUserModal()">Cancel</button>
</div>
<div class="modal hidden" id="termsModal">
<h2>Terms and Conditions</h2>
<div id="termsContent" style="white-space: pre-wrap; text-align: left;">
</div>
<button onclick="closeTermsAndConditionsModal()">Close</button>
</div>
<div class="modal hidden" id="alertDialog">
<h2 id="alertTitle"></h2>
<p id="alertMessage"></p>
<button onclick="closeAlertDialog()">OK</button>
</div>
<div class="modal hidden" id="addFakeUserModal">
<h2>Add Fake User</h2>
<p>Enter the name for the fake user:</p>
<div class="form-group">
<input id="addFakeUsernameInput" placeholder="Fake username" type="text"/>
</div>
<button onclick="confirmAddFakeUser()">Add</button>
<button onclick="closeAddFakeUserModal()">Cancel</button>
</div>
<div class="modal hidden" id="searchUserModal">
<h2>ğŸ” Search Users</h2>
<div class="form-group">
<label for="searchUsernameInput">Search Username:</label>
<input id="searchUsernameInput" placeholder="Enter username to search" type="text"/>
</div>
<button onclick="searchUser()">Search</button>
<div id="searchResults">
</div>
<button onclick="closeSearchUserModal()">Close</button>
</div>
<div class="modal hidden" id="adminModeModal">
<h2>Admin Account Mode</h2>
<p>Are you sure you want to enable admin account mode? You can't get banned if you say bad words, and using this mode for exploits might result in a permanent ban.</p>
<button onclick="enableAdminModeConfirmed()">Enable</button>
<button onclick="disableAdminModeConfirmed()">Disable</button>
<button onclick="closeAdminModeModal()">Cancel</button>
</div>
<div class="modal hidden" id="blockedUsersModal">
<h2>Blocked Users</h2>
<div id="blockedUsersList">
<p>No users blocked.</p>
</div>
<button onclick="closeBlockedUsersModal()">Close</button>
</div>
<script>
let captchaValue = "";

function generateCaptcha() {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
  captchaValue = "";
  for (let i = 0; i < 6; i++) {
    captchaValue += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  document.getElementById("captchaCode").textContent = captchaValue;
}

// Ensure captcha loads on page load
window.addEventListener("load", generateCaptcha);

const bannedWords = [
  "fuck", "shit", "ass", "asshole", "nigger", "bitch", "son of a bitch",
  "fucking", "nigga", "pussy", "puss", "dogshit", "bullshit", "kill", "cum",
  "penis", "f4ck", "sh1t", "2ss", "p4ss", "p4ssy", "n1gger", "2gger", "sus",
  "dick", "tits", "titis", "poop", "pee", "mock", "pipiska", "suck", "cock",
  "poopy", "motherfucker", "motherfucking", "cocky", "middle finger",
  "palestine", "sex", "gay", "s4x", "s2x", "g2y", "g4y", "cunt", "racist",
  "ibyprofun", "ibyprofen", "butt", "tylenol", "nazi", "naz", "anus", "sexy", "sexual",
  "cusemek", "cusomo",
  "abbo","abo","abortion","abuse","addict","addicts","adult","africa","african",
  "alla","allah","alligatorbait","amateur","american","anal","analannie",
  "analsex","angie","angry","arab","arabs","areola","argie","aroused","arse",
  "arsehole","asian","assassin","assassinate","assassination","assault",
  "assbagger","assblaster","assclown","asscowboy","asses","assfuck","assfucker",
  "asshat","assholes","asshore","assjockey","asskiss","asskisser","assklown",
  "asslick","asslicker","asslover","assman","assmonkey","assmunch","assmuncher",
  "asspacker","asspirate","asspuppies","assranger","asswhore","asswipe",
  "athletesfoot","attack","australian","babe","babies","backdoor","backdoorman",
  "backseat","badfuck","balllicker","balls","ballsack","banging","baptist",
  "barelylegal","barf","barface","barfface","bast","bastard","bazongas",
  "bazooms","beaner","beast","beastality","beastial","beastiality","beatoff",
  "beat-off","beatyourmeat","beaver","bestial","bestiality","bi","biatch",
  "bible","bicurious","bigass","bigbastard","bigbutt","bigger","bisexual",
  "bi-sexual","bitcher","bitches","bitchez","bitchin","bitching","bitchslap",
  "bitchy","biteme","black","blackman","blackout","blacks","blind","blow",
  "blowjob","boang","bogan","bohunk","bollick","bollock","bomb","bombers",
  "bombing","bombs","bomd","bondage","boner","bong","boob","boobies","boobs",
  "booby","boody","boom","boong","boonga","boonie","booty","bootycall",
  "bountybar","bra","brea5t","breast","breastjob","breastlover","breastman",
  "brothel","bugger","buggered","buggery","bullcrap","bulldike","bulldyke",
  "bullshit","bumblefuck","bumfuck","bunga","bunghole","buried","burn",
  "butchbabes","butchdike","butchdyke","buttbang","butt-bang","buttface",
  "buttfuck","butt-fuck","buttfucker","butt-fucker","buttfuckers",
  "butt-fuckers","butthead","buttman","buttmunch","buttmuncher","buttpirate",
  "buttplug","buttstain","byatch","cacker","cameljockey","cameltoe","canadian",
  "cancer","carpetmuncher","carruth","catholic","catholics","cemetery","chav",
  "cherrypopper","chickslick","children's","chin","chinaman","chinamen",
  "chinese","chink","chinky","choad","chode","christ","christian","church",
  "cigarette","cigs","clamdigger","clamdiver","clit","clitoris","clogwog",
  "cocaine","cockblock","cockblocker","cockcowboy","cockfight","cockhead",
  "cockknob","cocklicker","cocklover","cocknob","cockqueen","cockrider",
  "cocksman","cocksmith","cocksmoker","cocksucer","cocksuck","cocksucked",
  "cocksucker","cocksucking","cocktail","cocktease","cohee","coitus","color",
  "colored","coloured","commie","communist","condom","conservative",
  "conspiracy","coolie","cooly","coon","coondog","copulate","cornhole",
  "corruption","cra5h","crabs","crack","crackpipe","crackwhore","crack-whore",
  "crap","crapola","crapper","crappy","crash","creamy","crime","crimes",
  "criminal","criminals","crotch","crotchjockey","crotchmonkey","crotchrot",
  "cumbubble","cumfest","cumjockey","cumm","cummer","cumming","cumquat",
  "cumqueen","cumshot","cunilingus","cunillingus","cunn","cunnilingus",
  "cunntt","cunteyed","cuntfuck","cuntfucker","cuntlick","cuntlicker",
  "cuntlicking","cuntsucker","cybersex","cyberslimer","dago","dahmer","dammit",
  "damnation","damnit","darkie","darky","datnigga","dead","deapthroat","death",
  "deepthroat","defecate","dego","demon","deposit","desire","destroy","deth",
  "devil","devilworshipper","dickbrain","dickforbrains","dickhead","dickless",
  "dicklick","dicklicker","dickman","dickwad","dickweed","diddle","die","died",
  "dies","dike","dildo","dingleberry","dink","dipshit","dipstick","dirty",
  "disease","diseases","disturbed","dive","dix","dixiedike","dixiedyke",
  "doggiestyle","doggystyle","dong","doodoo","doo-doo","doom","dope",
  "dragqueen","dragqween","dripdick","drug","drunk","drunken","dumb","dumbass",
  "dumbbitch","dumbfuck","dyefly","dyke","easyslut","eatballs","eatme",
  "eatpussy","ecstacy","ejaculate","ejaculated","ejaculating","ejaculation",
  "enema","enemy","erect","erection","ero","escort","ethiopian","ethnic",
  "european","evl","excrement","execute","executed","execution","executioner",
  "explosion","facefucker","faeces","fag","fagging","faggot","fagot","failed",
  "failure","fairies","fairy","faith","fannyfucker","fart","farted","farting",
  "farty","fastfuck","fat","fatah","fatass","fatfuck","fatfucker","fatso",
  "fckcum","fear","feces","felatio","felch","felcher","felching","fellatio",
  "feltch","feltcher","feltching","fetish","fight","filipina","filipino",
  "fingerfood","fingerfuck","fingerfucked","fingerfucker","fingerfuckers",
  "fingerfucking","fire","firing","fister","fistfuck","fistfucked","fistfucker",
  "fistfucking","fisting","flange","flasher","flatulence","floo","flydie",
  "flydye","fok","fondle","footaction","footfuck","footfucker","footlicker",
  "footstar","fore","foreskin","forni","fornicate","foursome","fourtwenty",
  "fraud","freakfuck","freakyfucker","freefuck","fu","fubar","fuc","fucck",
  "fucka","fuckable","fuckbag","fuckbuddy","fucked","fuckedup","fuckers",
  "fuckface","fuckfest","fuckfreak","fuckfriend","fuckhead","fuckher","fuckin",
  "fuckina","fuckingbitch","fuckinnuts","fuckinright","fuckit","fuckknob",
  "fuckme","fuckmehard","fuckmonkey","fuckoff","fuckpig","fucks","fucktard",
  "fuckwhore","fuckyou","fudgepacker","fugly","fuk","fuks","funeral","funfuck",
  "fungus","fuuck","gangbang","gangbanged","gangbanger","gangsta","gatorbait",
  "gaymuthafuckinwhore","gaysex","geez","geezer","geni","genital","german",
  "getiton","gin","ginzo","gipp","girls","givehead","glazeddonut","gob","god",
  "godammit","goddamit","goddammit","goddamn","goddamned","goddamnes",
  "goddamnit","goddamnmuthafucker","goldenshower","gonorrehea","gonzagas",
  "gook","gotohell","goy","goyim","greaseball","gringo","groe","gross",
  "grostulation","gubba","gummer","gun","gyp","gypo","gypp","gyppie","gyppo",
  "gyppy","hamas","handjob","hapa","harder","hardon","harem","headfuck",
  "headlights","hebe","heeb","hell","henhouse","heroin","herpes","heterosexual",
  "hijack","hijacker","hijacking","hillbillies","hindoo","hiscock","hitler",
  "hitlerism","hitlerist","hiv","ho","hobo","hodgie","hoes","hole","holestuffer",
  "homicide","homo","homobangers","homosexual","honger","honk","honkers","honkey",
  "honky","hook","hooker","hookers","hooters","hore","hork","horn","horney",
  "horniest","horny","horseshit","hosejob","hoser","hostage","hotdamn",
  "hotpussy","hottotrot","hummer","husky","hussy","hustler","hymen","hymie",
  "iblowu","idiot","ikey","illegal","incest","insest","intercourse","interracial",
  "intheass","inthebuff","israel","israeli","israel's","italiano","itch",
  "jackass","jackoff","jackshit","jacktheripper","jade","jap","japanese",
  "japcrap","jebus","jeez","jerkoff","jesus","jesuschrist","jew","jewish",
  "jiga","jigaboo","jigg","jigga","jiggabo","jigger","jiggy","jihad","jijjiboo",
  "jimfish","jism","jiz","jizim","jizjuice","jizm","jizz","jizzim","jizzum",
  "joint","juggalo","jugs","junglebunny","kaffer","kaffir","kaffre","kafir",
  "kanake","kid","kigger","kike","killed","killer","killing","kills","kink",
  "kinky","kissass","kkk","knife","knockers","kock","kondum","koon","kotex",
  "krap","krappy","kraut","kum","kumbubble","kumbullbe","kummer","kumming",
  "kumquat","kums","kunilingus","kunnilingus","kunt","ky","kyke","lactate",
  "laid","lapdance","latin","lesbain","lesbayn","lesbian","lesbin","lesbo",
  "lez","lezbe","lezbefriends","lezbo","lezz","lezzo","liberal","libido","licker",
  "lickme","lies","limey","limpdick","limy","lingerie","liquor","livesex",
  "loadedgun","lolita","looser","loser","lotion","lovebone","lovegoo","lovegun",
  "lovejuice","lovemuscle","lovepistol","loverocket","lowlife","lsd","lubejob",
  "lucifer","luckycammeltoe","lugan","lynch","macaca","mad","mafia","magicwand",
  "mams","manhater","manpaste","marijuana","mastabate","mastabater","masterbate",
  "masterblaster","mastrabator","masturbate","masturbating","mattressprincess",
  "meatbeatter","meatrack","meth","mexican","mgger","mggor","mickeyfinn",
  "mideast","milf","minority","mockey","mockie","mocky","mofo","moky","moles",
  "molest","molestation","molester","molestor","moneyshot","mooncricket",
  "mormon","moron","moslem","mosshead","mothafuck","mothafucka","mothafuckaz",
  "mothafucked","mothafucker","mothafuckin","mothafucking","mothafuckings",
  "motherfuck","motherfucked","motherfuckin","motherfuckings","motherlovebone",
  "muff","muffdive","muffdiver","muffindiver","mufflikcer","mulatto","muncher",
  "munt","murder","murderer","muslim","naked","narcotic","nasty","nastybitch",
  "nastyho","nastyslut","nastywhore","nazi","necro","negro","negroes","negroid",
  "negro's","nig","niger","nigerian","nigerians","nigg","niggah","niggaracci",
  "niggard","niggarded","niggarding","niggardliness","niggardliness's",
  "niggardly","niggards","niggard's","niggaz","niggerhead","niggerhole",
  "niggers","nigger's","niggle","niggled","niggles","niggling","nigglings",
  "niggor","niggur","niglet","nignog","nigr","nigra","nigre","nip","nipple",
  "nipplering","nittit","nlgger","nlggor","nofuckingway","nook","nookey",
  "nookie","noonan","nooner","nude","nudger","nuke","nutfucker","nymph",
  "ontherag","oral","orga","orgasim","orgasm","orgies","orgy","osama","paki",
  "palesimian","palestinian","pansies","pansy","panti","panties","payo",
  "pearlnecklace","peck","pecker","peckerwood","pee-hole","peepshow","peepshpw",
  "pendy","penetration","peni5","penile","penises","penthouse","period","perv",
  "phonesex","phuk","phuked","phuking","phukked","phukking","phungky","phuq",
  "pi55","picaninny","piccaninny","pickaninny","piker","pikey","piky","pimp",
  "pimped","pimper","pimpjuic","pimpjuice","pimpsimp","pindick","pissed",
  "pisser","pisses","pisshead","pissin","pissing","pissoff","pistol","pixie",
  "pixy","playboy","playgirl","pocha","pocho","pocketpool","pohm","polack",
  "pom","pommie","pommy","poon","poontang","pooper","pooperscooper","pooping",
  "poorwhitetrash","popimp","porchmonkey","porn","pornflick","pornking","porno",
  "pornography","pornprincess","pot","poverty","premature","pric","prick",
  "prickhead","primetime","propaganda","pros","prostitute","protestant","pu55i",
  "pu55y","pube","pubic","pubiclice","pud","pudboy","pudd","puddboy","puke",
  "puntang","purinapricness","pussie","pussies","pussycat","pussyeater",
  "pussyfucker","pussylicker","pussylips","pussylover","pussypounder","pusy",
  "quashie","queef","queer","quickie","quim","ra8s","rabbi","racial","radical",
  "radicals","raghead","randy","rape","raped","raper","rapist","rearend",
  "rearentry","rectum","redlight","redneck","reefer","reestie","refugee","reject",
  "remains","rentafuck","republican","retard","retarded","ribbed","rigger",
  "rimjob","rimming","roach","robber","roundeye","rump","russki","russkie",
  "sadis","sadom","samckdaddy","sambo","sandm","sandnigger","satan","scag",
  "scallywag","scat","schlong","screw","screwyou","scrotum","scum","semen",
  "seppo","servant","sexed","sexfarm","sexhound","sexhouse","sexing","sexkitten",
  "sexpot","sexslave","sextogo","sextoy","sextoys","sexuality","sexwhore",
  "sexy-slim","sexymoma","sexy-slim","shag","shaggin","shagging","shat","shav",
  "shawtypimp","sheeney","shhit","shinola","shitcan","shitdick","shitface",
  "shitfaced","shitfit","shitforbrains","shitfuck","shitfucker","shitfull",
  "shithapens","shithappens","shithead","shithouse","shiting","shitlist",
  "shitoutofluck","shits","shitstain","shitted","shitter","shitting","shitty",
  "shoot","shooting","shortfuck","showtime","sick","sissy","sixsixsix","sixtynine",
  "sixtyniner","skank","skankbitch","skankfuck","skankwhore","skanky","skankybitch",
  "skankywhore","skinflute","skum","skumbag","slant","slanteye","slapper",
  "slaughter","slav","slave","slavedriver","sleezebag","sleezeball","slideitin",
  "slime","slimeball","slimebucket","slope","sloper","slant","slanteye",
  "slutt","sluttish","slutty","slutwhore","smack","smackthemonkey","smut",
  "snatch","sniper","snowback","snuff","sob","sodom","sodomise","sodomite",
  "sodomize","sodomy","sonofabitch","sooty","sos","soviet","spaghettibender",
  "spaghettinigger","spank","spankthemonkey","sperm","spermacide","spermbag",
  "spermhearder","spermherder","spic","spick","spig","spigotty","spik",
  "spit","spitter","splittail","spooge","spreadeagle","spunk","spunky",
  "squaw","stagg","stiffy","strapon","stringer","stripclub","stroke","stroking",
  "stupid","stupidfuck","stupidfucker","suicide","swallow","swallower","swastika",
  "sweetness","syphilis","tacohead","tampon","tantra","tarbaby","tard","terror",
  "terrorist","testical","testicle","thicklip","thirdeye","thirdleg","threesome",
  "threeway","timbernigger","tinkle","titbitnipply","titfuck","titfucker",
  "titfuckin","titjob","titlicker","titlover","titsucker","tittyfuck","tittyfucker",
  "tittywank","toilet","tongethruster","tongue","tonguethrust","tortur","torture",
  "tosser","towelhead","tramp","trannie","tranny","transexual","transsexual",
  "transvestite","triplex","trisexual","trots","tuckahoe","tunneloflove",
  "turd","turnon","twat","twink","twinkie","twobitwhore","uck","uk","unfuckable",
  "upskirt","uptheass","upthebutt","urinary","urinate","urine","usama","uterus",
  "vagina","vaginal","vatican","vibr","vibrater","vibrator","vietcong","violence",
  "virgin","virginbreaker","vomit","vulva","wab","wank","wanker","wanking",
  "waysted","weapon","weenie","weewee","welcher","welfare","wetb","wetback",
  "wetspot","whacker","whash","whigger","whiskey","whiskydick","whit","whitenigger",
  "whites","whitetrash","whitey","whiz","whop","whore","whorefucker","whorehouse",
  "wigger","willie","williewanker","willy","wn","wob","wog","woggie","woggy",
  "women's","wop","wtf","wuss","wuzzie","xtc","xxx","yankee","yellowman","zigabo",
  "zipperhead","zog"
];


    function formatTime(date) {
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    function filterText(text) {
      // If admin mode is enabled for the current user, bypass filtering
      if (currentUser && users[currentUser] && users[currentUser].isAdmin) {
        return text;
      }

      let containsBannedWord = false;
      const pattern = new RegExp(`\\b(${bannedWords.join('|')})\\b`, 'gi');
      const filteredText = text.replace(pattern, match => {
        containsBannedWord = true;
        return '*'.repeat(match.length);
      });

      if (containsBannedWord && currentUser) {
        increaseBadWordCount();
      }

      return filteredText;
    }

    function checkForSpam(text) {
      // If admin mode is enabled for the current user, bypass spam checks
      if (currentUser && users[currentUser] && users[currentUser].isAdmin) {
        return false;
      }

      if (!currentUser || !text.trim()) return false;

      // Initialize spam tracking if not exists
      if (!users[currentUser].spamTracker) {
        users[currentUser].spamTracker = {};
        users[currentUser].spamCount = 0;
      }

      // Split text into words and count each word
      const words = text.toLowerCase().split(/\s+/);
      let isSpam = false;

      words.forEach(word => {
        if (word.length > 2) { // Only track words longer than 2 characters
          if (!users[currentUser].spamTracker[word]) {
            users[currentUser].spamTracker[word] = 0;
          }
          users[currentUser].spamTracker[word]++;

          // Check if this word has been used too many times
          if (users[currentUser].spamTracker[word] === 10) {
            users[currentUser].spamCount = 10;
            isSpam = true;
          } else if (users[currentUser].spamTracker[word] >= 30) {
            users[currentUser].spamCount = 30;
            isSpam = true;
          }
        }
      });

      if (isSpam) {
        if (users[currentUser].spamCount === 10) {
          showSpamWarningModal();
          return true;
        } else if (users[currentUser].spamCount >= 30) {
          showSpamBanModal();
          users[currentUser].banned = true;
          return true;
        }
      }

      return false;
    }

    function increaseBadWordCount() {
      // If admin mode is enabled for the current user, bypass bad word count increase
      if (currentUser && users[currentUser] && users[currentUser].isAdmin) {
        return;
      }

      if (!users[currentUser].badWordCount) {
        users[currentUser].badWordCount = 0;
      }
      users[currentUser].badWordCount++;

      // Check if we need to show warning (at 5 bad words)
      if (users[currentUser].badWordCount === 5) {
        showWarningModal();
      }
      // Check if we need to ban (at 15 bad words)
      else if (users[currentUser].badWordCount >= 15) {
        showBanModal();
        // Mark account as banned
        users[currentUser].banned = true;
      }
    }

    // Generic function to open modals
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      document.getElementById('overlay').style.display = 'block';
      modal.classList.remove('hidden', 'closing');
      modal.style.display = 'block';
    }

    // Generic function to close modals with animation
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.add('closing');
      modal.addEventListener('animationend', function handler() {
        modal.classList.add('hidden');
        modal.style.display = 'none';
        modal.classList.remove('closing');
        modal.removeEventListener('animationend', handler);
        // Only hide overlay if no other modals are open
        const openModals = document.querySelectorAll('.modal:not(.hidden)');
        if (openModals.length === 0) {
          document.getElementById('overlay').style.display = 'none';
        }
      });
    }

    // Specific modal open/close functions using the generic ones
    function showWarningModal() {
      openModal('warningModal');
      document.getElementById('warningCheckbox').checked = false;
      document.getElementById('acknowledgeButton').disabled = true;
    }

    function showBanModal() {
      // If admin mode is enabled, do not ban
      if (currentUser && users[currentUser] && users[currentUser].isAdmin) {
        showAlertModal('Admin Mode Active', 'You are in admin mode, so your account will not be banned.');
        return;
      }
      openModal('banModal');
      users[currentUser].banned = true;
    }

    function showSpamWarningModal() {
      openModal('spamWarningModal');
      document.getElementById('spamWarningCheckbox').checked = false;
      document.getElementById('acknowledgeSpamButton').disabled = true;
    }

    function showSpamBanModal() {
      // If admin mode is enabled, do not ban
      if (currentUser && users[currentUser] && users[currentUser].isAdmin) {
        showAlertModal('Admin Mode Active', 'You are in admin mode, so your account will not be banned for spamming.');
        return;
      }
      openModal('spamBanModal');
      users[currentUser].banned = true;
    }

    function showLoginErrorModal(message) {
      document.getElementById('loginErrorMessage').textContent = message;
      openModal('loginErrorModal');
    }

    function showTermsAndConditions() {
      openModal('termsModal');
      const termsContent = `
Effective Date: 6/1/2025

Welcome to Lojani. These Terms and Conditions (â€œTermsâ€) govern your access to and use of our website, services, applications, and other offerings (collectively, the â€œServicesâ€). By accessing or using the Services, you agree to be bound by these Terms. If you do not agree, do not use our Services.

1. Use of Services
You agree to use our Services only for lawful purposes and in accordance with these Terms. You must not:
* Violate any applicable law or regulation.
* Interfere with the security or functionality of the Services.
* Use automated scripts to collect information or interact with the Services.

2. Eligibility
You must be at least 13 years old to use our Services, or have the consent of a parent or guardian.

3. User Content
You retain ownership of any content you submit to our Services. However, by submitting content, you grant us a non-exclusive, worldwide, royalty-free license to use, reproduce, modify, and distribute your content in connection with operating and improving the Services.

4. Intellectual Property
All content, trademarks, logos, and intellectual property on our Services are owned by or licensed to us. You may not use, copy, or distribute any of these without our prior written consent.

5. Privacy
Your use of the Services is also governed by our Privacy Policy, which explains how we collect and use your information.

6. Termination
We reserve the right to suspend or terminate your access to the Services at our sole discretion, without notice, if we believe you have violated these Terms or engaged in illegal or inappropriate behavior.

7. Disclaimer of Warranties
The Services are provided â€œas isâ€ without warranties of any kind, express or implied. We do not guarantee that the Services will be secure, error-free, or uninterrupted.

8. Limitation of Liability
To the fullest extent permitted by law, we shall not be liable for any indirect, incidental, special, or consequential damages resulting from your use of or inability to use the Services.

9. Changes to Terms
We may update these Terms from time to time. If we make significant changes, we will notify you. Your continued use of the Services after changes constitutes your acceptance of the updated Terms.

10. Governing Law
These Terms are governed by and construed in accordance with the laws of Nasbardash, without regard to its conflict of law provisions.

11. Contact Us
If you have questions about these Terms, please contact us at:
Email: Lojani@gmail.com
Address: Gen5 Corporation
      `;
      document.getElementById('termsContent').textContent = termsContent;
    }


    function acknowledgeWarning() {
      closeModal('warningModal');
    }

    function acknowledgeSpamWarning() {
      closeModal('spamWarningModal');
    }

    function closeLoginErrorModal() {
      closeModal('loginErrorModal');
    }

    // Delete Account Functions
    function showDeleteAccountModal() {
      closeModal('settingsModal'); // Close settings before opening delete modal
      openModal('deleteAccountModal');
      document.getElementById('deletePasswordInput').value = '';
    }

    function closeDeleteAccountModal() {
      closeModal('deleteAccountModal');
      openModal('settingsModal'); // Re-open settings modal
    }

    function deleteAccount() {
      const enteredPassword = document.getElementById('deletePasswordInput').value;
      const userPassword = accounts[currentUser].password; // Access password from the accounts object

      if (enteredPassword === userPassword) {
        // Mark account as banned (this will prevent login)
        users[currentUser].banned = true;
        users[currentUser].deleted = true;
        // Also remove admin status on deletion
        if (users[currentUser].isAdmin) {
            localStorage.removeItem(`isAdmin_${currentUser}`);
        }

        // Close modals and logout
        closeModal('deleteAccountModal');
        showAlertModal('Account Deleted', 'Your account has been permanently deleted.');
        logout();
      } else {
        showAlertModal('Error', 'Incorrect password. Account deletion cancelled.');
        closeModal('deleteAccountModal');
      }
    }


    // New functions for "How to delete Lojani data" modal
    function showDeleteDataModal() {
        closeModal('settingsModal'); // Close settings before opening delete data modal
        openModal('deleteDataModal');
    }

    function closeDeleteDataModal() {
        closeModal('deleteDataModal');
        openModal('settingsModal'); // Re-open settings modal
    }


    // Enable the acknowledge button only when checkbox is checked
    document.getElementById('warningCheckbox').addEventListener('change', function() {
      document.getElementById('acknowledgeButton').disabled = !this.checked;
    });

    // Enable the spam acknowledge button only when checkbox is checked
    document.getElementById('spamWarningCheckbox').addEventListener('change', function() {
      document.getElementById('acknowledgeSpamButton').disabled = !this.checked;
    });

    // Modified accounts object to store password, security question, and answer
    let accounts = {};
    let currentUser = null;
    let typingTimeout;
    let users = {};
    let messagesData = []; // Store all messages here

    // --- Local Storage Persistence ---
    function saveUserData() {
        localStorage.setItem('users', JSON.stringify(users));
        localStorage.setItem('accounts', JSON.stringify(accounts));
        localStorage.setItem('messagesData', JSON.stringify(messagesData));
        if (currentUser) {
            localStorage.setItem('currentUser', currentUser);
            localStorage.setItem(`isAdmin_${currentUser}`, users[currentUser].isAdmin);
            localStorage.setItem(`blockList_${currentUser}`, JSON.stringify(users[currentUser].blockList));
        }
    }

    function loadUserData() {
        const storedUsers = localStorage.getItem('users');
        const storedAccounts = localStorage.getItem('accounts');
        const storedMessagesData = localStorage.getItem('messagesData');
        const storedCurrentUser = localStorage.getItem('currentUser');

        if (storedUsers) {
            users = JSON.parse(storedUsers);
            // Ensure blockList, securityQuestion, securityAnswer exist for all loaded users
            for (const userKey in users) {
                if (!users[userKey].blockList) {
                    users[userKey].blockList = [];
                }
                if (!users[userKey].securityQuestion) { // Initialize securityQuestion if missing
                    users[userKey].securityQuestion = '';
                }
                if (!users[userKey].securityAnswer) { // Initialize securityAnswer if missing
                    users[userKey].securityAnswer = '';
                }
                // Load individual admin status and block list for each user
                users[userKey].isAdmin = localStorage.getItem(`isAdmin_${userKey}`) === 'true';
                const storedBlockList = localStorage.getItem(`blockList_${userKey}`);
                if (storedBlockList) {
                    users[userKey].blockList = JSON.parse(storedBlockList);
                }
            }
        }
        if (storedAccounts) {
            accounts = JSON.parse(storedAccounts);
        }
        if (storedMessagesData) {
            messagesData = JSON.parse(storedMessagesData);
        }
        if (storedCurrentUser && users[storedCurrentUser] && !users[storedCurrentUser].banned && !users[storedCurrentUser].deleted) {
            currentUser = storedCurrentUser;
        } else if (storedCurrentUser) {
            // Clear current user if they are banned/deleted
            currentUser = null;
            localStorage.removeItem('currentUser');
        }
    }


    // --- Screen Navigation ---
    function showScreen(idToShow) {
      const screens = ['loginScreen', 'createAccountScreen', 'messengerScreen'];
      screens.forEach(screenId => {
        const screenElement = document.getElementById(screenId);
        if (screenId === idToShow) {
          screenElement.classList.remove('hidden'); // Ensure it's not hidden
          setTimeout(() => {
            screenElement.classList.add('active'); // Add active class to trigger animation
          }, 10); // Small delay to allow 'hidden' removal to register
        } else {
          const currentScreen = document.getElementById(screenId);
          if (currentScreen.classList.contains('active')) {
            currentScreen.classList.remove('active'); // Start fade out
            setTimeout(() => {
              currentScreen.classList.add('hidden'); // Hide after animation
            }, 500); // Match CSS transition duration
          } else {
            currentScreen.classList.add('hidden'); // Immediately hide if not active
          }
        }
      });
    }

    function showLogin() {
      document.getElementById('loginUsername').value = ''; // Clear fields on screen change
      document.getElementById('loginPassword').value = '';
      document.getElementById('overlay').style.display = 'none'; // Ensure overlay is hidden when showing main screens
      document.querySelectorAll('.modal').forEach(modal => modal.classList.add('hidden', 'closing')); // Hide all modals
      showScreen('loginScreen');
      saveUserData(); // Save data on screen change (e.g., before closing tab)
    }

    function showCreateAccount() {
      document.getElementById('createUsername').value = ''; // Clear fields on screen change
      document.getElementById('createPassword').value = '';
      document.getElementById('securityQuestion').value = ''; // Clear security question field
      document.getElementById('securityAnswer').value = ''; // Clear security answer field
      document.getElementById('agreeCheckbox').checked = false;
      document.getElementById('overlay').style.display = 'none'; // Ensure overlay is hidden when showing main screens
      document.querySelectorAll('.modal').forEach(modal => modal.classList.add('hidden', 'closing')); // Hide all modals
      showScreen('createAccountScreen');
      saveUserData();
    }

    function showMessenger() {
      showScreen('messengerScreen');
      document.getElementById('currentUser').textContent = currentUser;
      updateUserDropdown();
      displayProfile();
      displayMessages(); // Display messages when messenger screen is shown
      saveUserData();
    }

    // --- User Authentication ---
    function login() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;

      const filteredUsername = filterText(username);

      if (filteredUsername !== username && !(users[username] && users[username].isAdmin)) { // Allow admin to have filtered username
        showLoginErrorModal('Your username contains inappropriate words.');
        return;
      }

      // First check if the account exists
      if (accounts[username] && accounts[username].password === password) { // Check password from object
        // Then check if the user is banned or deleted
        if (users[username] && (users[username].banned || users[username].deleted)) {
          showLoginErrorModal('This account has been banned and cannot be accessed.');
          return;
        }

        // If all checks pass, proceed with login
        currentUser = username;
        // Load admin status and block list from local storage for the current user
        users[currentUser].isAdmin = localStorage.getItem(`isAdmin_${currentUser}`) === 'true';
        const storedBlockList = localStorage.getItem(`blockList_${currentUser}`);
        if (storedBlockList) {
            users[currentUser].blockList = JSON.parse(storedBlockList);
        } else {
            users[currentUser].blockList = []; // Initialize if not present
        }
        showMessenger();
      } else {
        showLoginErrorModal('Invalid username or password.');
      }
      saveUserData();
    }

    function createAccount() {
  const enteredCaptcha = document.getElementById('captchaInput').value.trim();
  if (enteredCaptcha !== captchaValue) {
    showAlertModal('Captcha Error', 'The captcha you entered is incorrect. Please try again.');
    generateCaptcha();
    return;
  }

      const username = document.getElementById('createUsername').value.trim();
      const password = document.getElementById('createPassword').value;
      const securityQuestion = document.getElementById('securityQuestion').value.trim();
      const securityAnswer = document.getElementById('securityAnswer').value.trim();
      const agreeCheckbox = document.getElementById('agreeCheckbox');

      const filteredUsername = filterText(username);

      if (filteredUsername !== username) {
        showAlertModal('Invalid Username', 'Your username contains inappropriate words.');
        return;
      }

      if (!agreeCheckbox.checked) {
        showAlertModal('Terms Agreement Required', 'You must agree to the terms and conditions.');
        return;
      }

      // Validate security question and answer
      if (!securityQuestion || !securityAnswer) {
        showAlertModal('Security Question Required', 'Please set a security question and answer.');
        return;
      }

      if (accounts[username]) {
        showAlertModal('Creation Failed', 'Username already exists.');
      } else if (username && password && agreeCheckbox.checked) {
        // Store password, security question, and answer in the accounts object
        accounts[username] = {
            password: password,
            securityQuestion: securityQuestion,
            securityAnswer: securityAnswer
        };
        users[username] = {
          messages: [],
          profilePic: "https://templates.joomla-monster.com/joomla30/jm-news-portal/components/com_djclassifieds/assets/images/default_profile.png",
          aboutMe: '',
          country: '',
          badWordCount: 0,
          banned: false,
          deleted: false,
          spamTracker: {},
          spamCount: 0,
          joinDate: new Date().toISOString(), // Set join date on account creation
          isAdmin: false, // Default to not admin
          isPredefinedDemoUser: false, // NEW: This is NOT a predefined demo user
          blockList: [], // Initialize block list for new users
          securityQuestion: securityQuestion, // Store security question in user data
          securityAnswer: securityAnswer // Store security answer in user data
        };
        currentUser = username; // Automatically log in the new user
        showMessenger();
        showAlertModal('Account Created', 'Account created successfully. You are now logged in.');
      } else {
        showAlertModal('Invalid Input', 'Please fill out all fields correctly.');
      }
      saveUserData();
    }

    function logout() {
      currentUser = null;
      saveUserData(); // Save current user state before logging out

      // Immediately hide the overlay
      document.getElementById('overlay').style.display = 'none';

      // Immediately hide and reset all modals
      document.querySelectorAll('.modal').forEach(modal => {
        modal.classList.add('hidden');
        modal.classList.remove('closing'); // Ensure 'closing' class is removed
        modal.style.display = 'none'; // Directly set display to none
      });

      // Ensure all main screen containers are reset before showing login
      const screens = ['loginScreen', 'createAccountScreen', 'messengerScreen'];
      screens.forEach(screenId => {
        const screenElement = document.getElementById(screenId);
        screenElement.classList.remove('active'); // Remove active from all
        screenElement.classList.add('hidden'); // Ensure all are hidden
      });

      // Now show the login screen
      showLogin();
    }

    // --- Messaging ---

function sendFile() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];

  if (!file || !currentUser) return;

  const fileURL = URL.createObjectURL(file);
  const timestamp = new Date();

  const fileMessage = {
    id: Date.now(),
    sender: currentUser,
    text: `[FILE] ${file.name}`,
    timestamp: timestamp.toISOString(),
    profilePic: users[currentUser].profilePic || 'https://via.placeholder.com/40',
    fileURL: fileURL,
    fileName: file.name,
    fileType: file.type
  };

  messagesData.push(fileMessage);
  displayMessages();
  fileInput.value = '';
  saveUserData();
}

    function sendMessage() {
      const messageInput = document.getElementById('messageInput');
      let messageText = messageInput.value.trim();

      // Check if user is banned before allowing message
      if (currentUser && users[currentUser].banned) {
        if (users[currentUser].spamCount >= 30) {
          showSpamBanModal();
        } else {
          showBanModal();
        }
        return;
      }

      // Check if the current user is blocked by any other user
      // This is primarily for the client-side simulation; actual blocking would be server-side
      const isBlockedBySomeone = Object.values(users).some(user => user.blockList && user.blockList.includes(currentUser));
      if (isBlockedBySomeone) {
        // In a real application, the message might be sent but not delivered to the blocking user.
        // For this client-side demo, we'll just show an alert and not add the message.
        showAlertModal('Message Not Sent', 'You cannot send messages to users who have blocked you.');
        messageInput.value = '';
        return;
      }

      if (messageText) {
        // Check for spam first (bypassed if admin)
        if (checkForSpam(messageText)) {
          messageInput.value = '';
          saveUserData(); // Save after potential spam ban
          return;
        }

        const filteredText = filterText(messageText); // This also handles bad word count increase (bypassed if admin)
        const timestamp = new Date();

        const newMessage = {
          id: Date.now(), // Unique ID for the message
          sender: currentUser,
          text: filteredText,
          timestamp: timestamp.toISOString(), // Store as ISO string for consistency
          profilePic: users[currentUser].profilePic || 'https://via.placeholder.com/40'
        };

        messagesData.push(newMessage); // Add to global messages array
        displayMessages(); // Re-render all messages
        messageInput.value = '';
        hideTypingIndicator();
        saveUserData(); // Save after sending message
      }
    }

    function displayMessages() {
      const messagesContainer = document.getElementById('messages');
      messagesContainer.innerHTML = ''; // Clear existing messages

      const currentUserBlockList = users[currentUser] ? users[currentUser].blockList : [];

      messagesData.forEach(message => {
        // Only display messages if the sender is not in the current user's block list
        if (!currentUserBlockList.includes(message.sender)) {
          const messageElement = document.createElement('div');
          messageElement.classList.add('message');
          if (message.sender === currentUser) { // Add a class for current user messages
            messageElement.classList.add('current-user');
          }
          messageElement.setAttribute('data-message-id', message.id); // Set message ID for targeting

          const profilePic = document.createElement('img');
          profilePic.classList.add('profile-pic');
          profilePic.src = message.profilePic;

          const messageContent = document.createElement('div');
          messageContent.classList.add('message-content');

          const messageHeader = document.createElement('div');
          messageHeader.classList.add('message-header');

          const usernameSpan = document.createElement('span');
          usernameSpan.textContent = message.sender;

          const timeSpan = document.createElement('span');
          timeSpan.classList.add('message-time');
          timeSpan.textContent = formatTime(new Date(message.timestamp)); // Convert back to Date object

          messageHeader.appendChild(usernameSpan);
          messageHeader.appendChild(timeSpan);

          const messageTextP = document.createElement('p');
          messageTextP.classList.add('message-text');
          if (message.fileURL) {
          const fileLink = document.createElement('a');
          fileLink.href = message.fileURL;
          fileLink.textContent = `ğŸ“ ${message.fileName}`;
          fileLink.download = message.fileName;
          fileLink.target = "_blank";
          fileLink.style.wordBreak = "break-all";
          messageTextP.appendChild(fileLink);
        } else {
          messageTextP.textContent = message.text;
        }

          messageContent.appendChild(messageHeader);
          messageContent.appendChild(messageTextP);

          messageElement.appendChild(profilePic);
          messageElement.appendChild(messageContent);

          // Add message options dropdown
          const optionsDiv = document.createElement('div');
          optionsDiv.classList.add('message-options');
          optionsDiv.textContent = '...'; // Three dots for options
          optionsDiv.onclick = (event) => toggleMessageOptions(event, message.id, message.sender);

          const optionsDropdown = document.createElement('div');
          optionsDropdown.classList.add('message-options-dropdown');
          optionsDropdown.id = `dropdown-${message.id}`;

          if (message.sender === currentUser) {
            const editButton = document.createElement('button');
            editButton.textContent = 'Edit';
            editButton.onclick = () => editMessage(message.id);
            optionsDropdown.appendChild(editButton);

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.onclick = () => deleteMessage(message.id);
            optionsDropdown.appendChild(deleteButton);
          } else {
            const reportButton = document.createElement('button');
            reportButton.textContent = 'Report User';
            reportButton.onclick = () => reportUser(message.sender);
            optionsDropdown.appendChild(reportButton);

            // Add Block/Unblock button
            const blockButton = document.createElement('button');
            const isBlocked = users[currentUser].blockList.includes(message.sender);
            blockButton.textContent = isBlocked ? 'Unblock User' : 'Block User';
            blockButton.onclick = () => toggleBlockUser(message.sender);
            optionsDropdown.appendChild(blockButton);
          }

          messageElement.appendChild(optionsDiv);
          messageElement.appendChild(optionsDropdown);

          messagesContainer.appendChild(messageElement);
        }
      });
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function toggleMessageOptions(event, messageId, sender) {
      event.stopPropagation(); // Prevent the click from propagating to document
      const dropdown = document.getElementById(`dropdown-${messageId}`);
      // Close all other dropdowns
      document.querySelectorAll('.message-options-dropdown').forEach(d => {
        if (d.id !== `dropdown-${messageId}`) {
          d.style.display = 'none';
        }
      });
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', (event) => {
      document.querySelectorAll('.message-options-dropdown').forEach(dropdown => {
        dropdown.style.display = 'none';
      });
    });

    let messageToEditId = null;

    function editMessage(messageId) {
      messageToEditId = messageId;
      const message = messagesData.find(m => m.id === messageId);
      if (message && message.sender === currentUser) {
        document.getElementById('editMessageInput').value = message.text;
        openModal('editMessageModal');
      }
    }

    function saveEditedMessage() {
      if (messageToEditId) {
        const editedText = document.getElementById('editMessageInput').value.trim();
        if (editedText) {
          const messageIndex = messagesData.findIndex(m => m.id === messageToEditId);
          if (messageIndex !== -1) {
            messagesData[messageIndex].text = filterText(editedText);
            messagesData[messageIndex].timestamp = new Date().toISOString(); // Update timestamp on edit
            displayMessages();
            closeEditMessageModal();
            saveUserData(); // Save after editing message
          }
        } else {
          showAlertModal('Empty Message', 'Message cannot be empty.');
        }
      }
    }

    function closeEditMessageModal() {
      messageToEditId = null;
      closeModal('editMessageModal');
    }

    function deleteMessage(messageId) {
      showAlertModal('Confirm Deletion', 'Are you sure you want to delete this message?');
      document.getElementById('alertDialog').querySelector('button').onclick = () => {
        messagesData = messagesData.filter(m => m.id !== messageId);
        displayMessages();
        saveUserData(); // Save after deleting message
        closeAlertDialog();
      };
    }

    let userToReport = null;

    function reportUser(username) {
      userToReport = username;
      document.getElementById('reportedUsername').textContent = username;
      document.getElementById('reportReason').value = '';
      openModal('reportUserModal');
    }

    function confirmReportUser() {
      const reason = document.getElementById('reportReason').value.trim();
      if (userToReport && reason) {
        console.log(`User ${currentUser} reported ${userToReport} for: ${reason}`);
        showAlertModal('User Reported', `User ${userToReport} has been reported. Thank you for your feedback.`);
        closeReportUserModal();
      } else {
        showAlertModal('Report Failed', 'Please provide a reason for reporting.');
      }
    }

    function closeReportUserModal() {
      userToReport = null;
      closeModal('reportUserModal');
    }

    function showTypingIndicator() {
      const typingIndicator = document.getElementById('typingIndicator');
      typingIndicator.textContent = `${currentUser} is typing...`;
      clearTimeout(typingTimeout);
    }

    function hideTypingIndicator() {
      typingTimeout = setTimeout(() => {
        document.getElementById('typingIndicator').textContent = '';
      }, 1000);
    }

    // --- Settings ---
    function openSettings() {
      // Check if user is banned before allowing settings changes
      if (currentUser && users[currentUser].banned) {
        if (users[currentUser].spamCount >= 30) {
          showSpamBanModal();
        } else {
          showBanModal();
        }
        return;
      }

      openModal('settingsModal');
      const user = users[currentUser];
      document.getElementById('changeName').value = currentUser;
      document.getElementById('aboutMeInput').value = user.aboutMe;
      document.getElementById('countrySelect').value = user.country;

      // Set the join date input and disable if not admin
      const joinDateInput = document.getElementById('joinDateInput');
      const joinDate = user.joinDate ? new Date(user.joinDate) : null;
      joinDateInput.value = joinDate ? joinDate.toISOString().split('T')[0] : '';

      // Disable join date input if not an admin
      joinDateInput.disabled = !(currentUser && users[currentUser].isAdmin);
    }

    function closeSettings() {
      closeModal('settingsModal');
    }

    function saveSettings() {
      const oldUsername = currentUser;
      const newName = document.getElementById('changeName').value.trim();
      if (newName && newName !== oldUsername) {
        const filteredName = filterText(newName);
        if (filteredName !== newName && !(users[oldUsername] && users[oldUsername].isAdmin)) { // Allow admin to have filtered name
          showAlertModal('Invalid Username', 'Your username contains inappropriate words.');
          return;
        }

        // Update accounts and users with the new username
        accounts[filteredName] = accounts[oldUsername];
        delete accounts[oldUsername];

        users[filteredName] = users[oldUsername];
        delete users[oldUsername];

        // Update current user
        currentUser = filteredName;

        // Update local storage keys for admin status and block list
        localStorage.removeItem(`isAdmin_${oldUsername}`);
        localStorage.setItem(`isAdmin_${currentUser}`, users[currentUser].isAdmin);
        localStorage.removeItem(`blockList_${oldUsername}`);
        localStorage.setItem(`blockList_${currentUser}`, JSON.stringify(users[currentUser].blockList));


        document.getElementById('currentUser').textContent = currentUser;
      }

      const aboutMeInput = document.getElementById('aboutMeInput').value.trim();
      if (aboutMeInput) {
        const filteredAboutMe = filterText(aboutMeInput);
        users[currentUser].aboutMe = filteredAboutMe;
      }

      const profilePicInput = document.getElementById('profilePicInput');
      if (profilePicInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          users[currentUser].profilePic = e.target.result;
          displayProfile(); // Update profile immediately
          saveUserData(); // Save after updating profile picture
        };
        reader.readAsDataURL(profilePicInput.files[0]);
      }

      const selectedCountry = document.getElementById('countrySelect').value;
      if (selectedCountry) {
        users[currentUser].country = selectedCountry;
      }

      const joinDateInput = document.getElementById('joinDateInput');
      // Only allow changing join date if the input is enabled (meaning admin mode is active)
      if (!joinDateInput.disabled && joinDateInput.value) {
          users[currentUser].joinDate = new Date(joinDateInput.value).toISOString();
      }
      // Removed the 'else if' that triggered the alert when the field was disabled and had a value.
      // This ensures no alert pops up when merely saving other settings.


      closeSettings();
      displayProfile();
      updateUserDropdown();
      displayMessages(); // Re-display messages to update sender name if changed
      saveUserData(); // Save after saving settings
    }

    // --- Change Password Functions ---
    function showChangePasswordModal() {
        closeModal('settingsModal'); // Close settings modal
        openModal('changePasswordModal'); // Open change password modal
        // Clear input fields when showing the modal
        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmNewPassword').value = '';
    }

    function closeChangePasswordModal() {
        closeModal('changePasswordModal'); // Close change password modal
        openModal('settingsModal'); // Re-open settings modal
    }

    function saveNewPassword() {
        const currentPassword = document.getElementById('currentPassword').value; // Get current password input
        const newPassword = document.getElementById('newPassword').value; // Get new password input
        const confirmNewPassword = document.getElementById('confirmNewPassword').value; // Get confirm new password input

        if (currentPassword === '') { // Check if current password is empty
            showAlertModal('Error', 'Please enter your current password.'); // Show error if empty
            return;
        }

        if (newPassword === '' || confirmNewPassword === '') { // Check if new passwords are empty
            showAlertModal('Error', 'Please enter and confirm your new password.'); // Show error if empty
            return;
        }

        if (newPassword !== confirmNewPassword) { // Check if new passwords match
            showAlertModal('Error', 'New passwords do not match.'); // Show error if mismatch
            return;
        }

        if (accounts[currentUser].password !== currentPassword) { // Check if current password is correct
            showAlertModal('Error', 'Incorrect current password.'); // Show error if incorrect
            return;
        }

        // Update the password in the accounts object
        accounts[currentUser].password = newPassword;
        showAlertModal('Success', 'Your password has been changed successfully!'); // Show success message
        closeChangePasswordModal(); // Close the modal
        saveUserData(); // Save after changing password
    }

    // --- Forgot Password Functions ---
    function showForgotPassword() {
        closeModal('loginScreen');
        openModal('forgotPasswordModal');
        document.getElementById('forgotPasswordUsername').value = '';
        document.getElementById('forgotSecurityQuestion').value = ''; // Clear security question field
        document.getElementById('forgotSecurityAnswer').value = ''; // Clear security answer field
        document.getElementById('retrievedPassword').textContent = ''; // Clear previous message
    }

    function closeForgotPasswordModal() {
        closeModal('forgotPasswordModal');
        showLogin();
    }

    function showPassword() {
        const username = document.getElementById('forgotPasswordUsername').value.trim();
        const enteredSecurityQuestion = document.getElementById('forgotSecurityQuestion').value.trim();
        const enteredSecurityAnswer = document.getElementById('forgotSecurityAnswer').value.trim();
        const retrievedPasswordDisplay = document.getElementById('retrievedPassword');

        if (!username) {
            retrievedPasswordDisplay.textContent = 'Please enter a username.';
            retrievedPasswordDisplay.style.color = '#d9534f'; // Red for error
            return;
        }

        if (!accounts[username]) {
            retrievedPasswordDisplay.textContent = 'Username not found.';
            retrievedPasswordDisplay.style.color = '#d9534f'; // Red for error
            return;
        }

        const storedAccount = accounts[username];

        if (storedAccount.securityQuestion !== enteredSecurityQuestion || storedAccount.securityAnswer !== enteredSecurityAnswer) {
            retrievedPasswordDisplay.textContent = 'Incorrect security question or answer.';
            retrievedPasswordDisplay.style.color = '#d9534f'; // Red for error
            return;
        }

        // If username and security Q&A match, display the password
        retrievedPasswordDisplay.textContent = `Your password is: ${storedAccount.password}`;
        retrievedPasswordDisplay.style.color = '#28a745'; // Green for success
    }


    // --- Admin Account Mode ---
    function toggleAdminMode() {
        closeModal('settingsModal');
        openModal('adminModeModal');
    }

    function enableAdminModeConfirmed() {
        if (currentUser) {
            users[currentUser].isAdmin = true;
            localStorage.setItem(`isAdmin_${currentUser}`, 'true'); // Persist admin status
            showAlertModal('Admin Mode Enabled', 'You are now in admin account mode. Moderation checks will be bypassed.');
        }
        closeAdminModeModal();
        saveUserData(); // Save after changing admin mode
    }

    function disableAdminModeConfirmed() {
        if (currentUser) {
            users[currentUser].isAdmin = false;
            localStorage.setItem(`isAdmin_${currentUser}`, 'false'); // Persist admin status
            showAlertModal('Admin Mode Disabled', 'Admin account mode has been disabled. Moderation checks are now active.');
        }
        closeAdminModeModal();
        saveUserData(); // Save after changing admin mode
    }

    function closeAdminModeModal() {
        closeModal('adminModeModal');
        openModal('settingsModal'); // Re-open settings modal
    }


    // --- User List and Switching ---
    function updateUserDropdown() {
      const userSelect = document.getElementById('userSelect');
      userSelect.innerHTML = '<option value="">Select User</option>';
      Object.keys(users).forEach(user => {
        // Only show users that are not banned, not deleted, and are NOT predefined demo users
        if (!users[user].banned && !users[user].deleted && !users[user].isPredefinedDemoUser) {
          const option = document.createElement('option');
          option.value = user;
          option.textContent = user;
          userSelect.appendChild(option);
        }
      });
      // Set the currently active user in the dropdown
      if (currentUser) {
        userSelect.value = currentUser;
      }
    }

    function switchUser() {
      const userSelect = document.getElementById('userSelect');
      const selectedUser = userSelect.value;
      if (selectedUser && selectedUser !== currentUser) {
        // Check if the selected user is banned or deleted
        if (users[selectedUser].banned || users[selectedUser].deleted) {
          showLoginErrorModal('This account has been banned and cannot be accessed.');
          userSelect.value = currentUser; // Revert dropdown selection
          return;
        }

        currentUser = selectedUser;
        // Load admin status and block list for the switched user
        users[currentUser].isAdmin = localStorage.getItem(`isAdmin_${currentUser}`) === 'true';
        const storedBlockList = localStorage.getItem(`blockList_${currentUser}`);
        if (storedBlockList) {
            users[currentUser].blockList = JSON.parse(storedBlockList);
        } else {
            users[currentUser].blockList = [];
        }
        showMessenger(); // Update UI for the switched user
        saveUserData(); // Save after switching user
      }
    }

    // --- Profile Display ---
    function displayProfile() {
      const user = users[currentUser];
      if (user) {
        const aboutMeText = user.aboutMe || 'No bio set.';
        document.getElementById('aboutMeText').textContent = aboutMeText;

        let countryText = user.country ? `From: ${user.country}` : 'No country selected.';
        const joinDate = user.joinDate ? new Date(user.joinDate) : null;

        // Easter Egg Logic
        if (joinDate) {
          const easterEggDate = new Date('1958-04-01');
          if (joinDate.getFullYear() === easterEggDate.getFullYear() &&
              joinDate.getMonth() === easterEggDate.getMonth() &&
              joinDate.getDate() === easterEggDate.getDate() &&
              user.country === 'Niger') {
            countryText = 'From: *****';
          }
        }
        document.getElementById('countryText').textContent = countryText;

        const joinDateText = user.joinDate ? `Joined: ${new Date(user.joinDate).toLocaleDateString()}` : 'Not available.';
        document.getElementById('joinDateText').textContent = joinDateText;
      }
    }

    // --- Fake User ---
    
    function confirmAddFakeUser() {
      const fakeUsername = document.getElementById('addFakeUsernameInput').value;
      if (fakeUsername) {
        const username = fakeUsername.trim();
        if (username && !accounts[username]) {
          accounts[username] = {
            password: 'password', // Default password for fake users
            securityQuestion: 'What is my favorite color?', // Default security question
            securityAnswer: 'blue' // Default security answer
          };
          users[username] = {
            messages: [],
            profilePic: null,
            aboutMe: 'I am a fake user.',
            country: 'Wonderland',
            badWordCount: 0,
            banned: false,
            deleted: false,
            spamTracker: {},
            spamCount: 0,
            joinDate: new Date().toISOString(), // Set join date for fake users
            isAdmin: false, // Fake users are not admins by default
            isPredefinedDemoUser: false, // NEW: User-created fake users are NOT predefined demo users
            blockList: [], // Initialize block list for fake users
            securityQuestion: accounts[username].securityQuestion, // Add to user data as well
            securityAnswer: accounts[username].securityAnswer // Add to user data as well
          };
          updateUserDropdown();
          showAlertModal('Fake User Added', `Fake user "${username}" added.`);
          closeAddFakeUserModal();
          saveUserData(); // Save after adding fake user
        } else {
          showAlertModal('Error', 'Username already exists or is invalid.');
        }
      } else {
        showAlertModal('Error', 'Please enter a username for the fake user.');
      }
    }

    function closeAddFakeUserModal() {
      closeModal('addFakeUserModal');
    }

    // --- Search User System ---
    function openSearchUserModal() {
      document.getElementById('searchUsernameInput').value = '';
      document.getElementById('searchResults').innerHTML = ''; // Clear previous results
      openModal('searchUserModal');
    }

    function searchUser() {
      const query = document.getElementById('searchUsernameInput').value.trim().toLowerCase();
      const searchResultsDiv = document.getElementById('searchResults');
      searchResultsDiv.innerHTML = ''; // Clear previous results

      if (query.length === 0) {
        searchResultsDiv.innerHTML = '<p>Please enter a username to search.</p>';
        return;
      }

      const foundUsers = Object.keys(users).filter(username =>
        username.toLowerCase().includes(query) && !users[username].deleted // Do not show deleted users
      );

      if (foundUsers.length > 0) {
        foundUsers.forEach(username => {
          const user = users[username];
          const resultItem = document.createElement('div');
          resultItem.classList.add('search-result-item');
          resultItem.innerHTML = `
            <h4>${username}</h4>
            <p><strong>Bio:</strong> ${user.aboutMe || 'No bio set.'}</p>
            <p><strong>Country:</strong> ${user.country || 'No country selected.'}</p>
            <p><strong>Joined:</strong> ${user.joinDate ? new Date(user.joinDate).toLocaleDateString() : 'Not available.'}</p>
            ${user.banned ? '<p style="color: red; font-weight: bold;">(Banned)</p>' : ''}
            ${user.isAdmin ? '<p style="color: green; font-weight: bold;">(Admin)</p>' : ''}
          `;
          // Optional: Add a click listener to switch to that user's profile or display more details
          resultItem.addEventListener('click', () => {
            // For now, we'll just show an alert or you can extend this to view profile in messenger
            showAlertModal('User Details', `
                Username: ${username}
                Bio: ${user.aboutMe || 'No bio set.'}
                Country: ${user.country || 'No country selected.'}
                Joined: ${user.joinDate ? new Date(user.joinDate).toLocaleDateString() : 'Not available.'}
                Status: ${user.banned ? 'Banned' : 'Active'}
                Admin: ${user.isAdmin ? 'Yes' : 'No'}
            `);
          });
          searchResultsDiv.appendChild(resultItem);
        });
      } else {
        searchResultsDiv.innerHTML = '<p>No users found matching your search.</p>';
      }
    }

    function closeSearchUserModal() {
      closeModal('searchUserModal');
    }

    // --- Terms and Conditions Functions ---
    function closeTermsAndConditionsModal() {
      closeModal('termsModal');
    }

    // --- Generic Alert Modal ---
    function showAlertModal(title, message) {
      document.getElementById('alertTitle').textContent = title;
      document.getElementById('alertMessage').textContent = message;
      openModal('alertDialog');
    }

    function closeAlertDialog() {
      closeModal('alertDialog');
    }

    // --- User Blocking Functions ---
    function toggleBlockUser(usernameToBlock) {
        if (!currentUser || currentUser === usernameToBlock) {
            showAlertModal('Error', 'Cannot block yourself.');
            return;
        }

        const userBlockList = users[currentUser].blockList;
        const index = userBlockList.indexOf(usernameToBlock);

        if (index > -1) {
            // User is already blocked, unblock them
            userBlockList.splice(index, 1);
            showAlertModal('User Unblocked', `${usernameToBlock} has been unblocked.`);
        } else {
            // User is not blocked, block them
            userBlockList.push(usernameToBlock);
            showAlertModal('User Blocked', `${usernameToBlock} has been blocked. You will no longer see their messages.`);
        }
        localStorage.setItem(`blockList_${currentUser}`, JSON.stringify(userBlockList)); // Persist block list
        displayMessages(); // Re-render messages to apply block/unblock
        displayBlockedUsers(); // Update the blocked users list if the modal is open
    }

    function openBlockedUsersModal() {
        openModal('blockedUsersModal');
        displayBlockedUsers();
    }

    function closeBlockedUsersModal() {
        closeModal('blockedUsersModal');
    }

    function displayBlockedUsers() {
        const blockedUsersListDiv = document.getElementById('blockedUsersList');
        blockedUsersListDiv.innerHTML = '';

        if (!currentUser || !users[currentUser] || users[currentUser].blockList.length === 0) {
            blockedUsersListDiv.innerHTML = '<p>No users blocked.</p>';
            return;
        }

        users[currentUser].blockList.forEach(blockedUsername => {
            const blockedUserItem = document.createElement('div');
            blockedUserItem.classList.add('blocked-user-item');
            blockedUserItem.innerHTML = `
                <span>${blockedUsername}</span>
                <button onclick="toggleBlockUser('${blockedUsername}')">Unblock</button>
            `;
            blockedUsersListDiv.appendChild(blockedUserItem);
        });
    }

    // --- Initialization ---
    // Add demo users
    function initializeDemoUsers() {
      const currentDateTime = new Date().toISOString();

      // Demo User 1
      if (!accounts['TheLimitOfLojani']) { // Only add if not already present from local storage
          accounts['TheLimitOfLojani'] = {
            password: 'RenPentagonGolaotaMosotyaCototya83839848398901302',
            securityQuestion: 'What is the limit?',
            securityAnswer: 'sky'
          };
          users['TheLimitOfLojani'] = {
            messages: [],
            profilePic: "https://dinopixel.com/preload/0222/squirtle.png",
            aboutMe: 'Testing the limits of Lojani.',
            country: 'Niue',
            badWordCount: 999999999999,
            banned: false,
            deleted: false,
            spamTracker: {},
            spamCount: 999999999999999,
            joinDate: new Date('2001-01-01').toISOString(),
            isAdmin: true,
            isPredefinedDemoUser: true, // Renamed and set to true for predefined demos
            blockList: [],
            securityQuestion: accounts['TheLimitOfLojani'].securityQuestion,
            securityAnswer: accounts['TheLimitOfLojani'].securityAnswer
          };
      }


      // Demo User 2
      if (!accounts['Bianka Harold']) {
          accounts['Bianka Harold'] = {
            password: 'ilovemom123',
            securityQuestion: 'First pet name?',
            securityAnswer: 'buddy'
          };
          users['Bianka Harold'] = {
            messages: [],
            profilePic: "https://templates.joomla-monster.com/joomla30/jm-news-portal/components/com_djclassifieds/assets/images/default_profile.png", // Example custom URL
            aboutMe: 'I love hanging out with my mom. me from Norfolk Island btw.',
            country: 'Norfolk Island',
            badWordCount: 0,
            banned: false,
            deleted: false,
            spamTracker: {},
            spamCount: 0,
            joinDate: new Date('2023-11-07').toISOString(),
            isAdmin: false,
            isPredefinedDemoUser: true, // Renamed and set to true for predefined demos
            blockList: [],
            securityQuestion: accounts['Bianka Harold'].securityQuestion,
            securityAnswer: accounts['Bianka Harold'].securityAnswer
          };
      }


      // Demo User 3
      if (!accounts['OfficialChocki']) {
          accounts['OfficialChocki'] = {
            password: 'ChockiLovesSnacks!',
            securityQuestion: 'What snack will you never share with the FBI?',
            securityAnswer: 'Chockiâ€™s Secret Cookies'
          };
          users['OfficialChocki'] = {
            messages: [],
            profilePic: "https://media.istockphoto.com/id/1170107790/vector/cartoon-chocolate-chip-cookie-character.jpg?s=612x612&w=0&k=20&c=fPZ9ds4gq_e23mupAjiX86rtPLnJIbPym4L-cMmbFqk=",
            aboutMe: ' Snack enthusiast. Avoider of FBI. Lover of flight buttons.',
            country: 'Wonderland',
            badWordCount: 0,
            banned: false,
            deleted: false,
            spamTracker: {},
            spamCount: 0,
            joinDate: new Date('2025-03-15').toISOString(),
            isAdmin: false,
            isPredefinedDemoUser: true, // Renamed and set to true for predefined demos
            blockList: [],
            securityQuestion: accounts['OfficialChocki'].securityQuestion,
            securityAnswer: accounts['OfficialChocki'].securityAnswer
          };
      }


      // Demo User 4
      if (!accounts['Fadeo993']) {
          accounts['Fadeo993'] = {
            password: 'fadeoISTheBEST',
            securityQuestion: 'First car model?',
            securityAnswer: 'honda'
          };
          users['Fadeo993'] = {
            messages: [],
            profilePic: "https://i.pinimg.com/736x/f4/2b/b6/f42bb65dd04ff0d497940580facee77a.jpg",
            aboutMe: 'Bem-vindo! Fazendo com que cada dia pareÃ§a um abraÃ§o caloroso.',
            country: 'Cabo Verde',
            badWordCount: 0,
            banned: false,
            deleted: false,
            spamTracker: {},
            spamCount: 0,
            joinDate: new Date('2003-09-01').toISOString(),
            isAdmin: false,
            isPredefinedDemoUser: true, // Renamed and set to true for predefined demos
            blockList: [],
            securityQuestion: accounts['Fadeo993'].securityQuestion,
            securityAnswer: accounts['Fadeo993'].securityAnswer
          };
      }

      // Demo User 5
      if (!accounts['Lojani']) {
          accounts['Lojani'] = {
            password: 'SWjnDSW8BYbr6oC2ysbDD6RqPEMhNQjK2q4xDoWbjF9FDK5Jpw',
            securityQuestion: 'What is The Password Code?',
            securityAnswer: '92377873575835255322'
          };
          users['Lojani'] = {
            messages: [],
            profilePic: "https://png.pngtree.com/png-vector/20220609/ourmid/pngtree-administrator-account-avatar-boss-business-png-image_4941747.png",
            aboutMe: 'The Official Account of Lojani',
            country: 'Nasbardash',
            badWordCount: 0,
            banned: false,
            deleted: false,
            spamTracker: {},
            spamCount: 0,
            joinDate: new Date('1994-02-12').toISOString(),
            isAdmin: true,
            isPredefinedDemoUser: true, // Renamed and set to true for predefined demos
            blockList: [],
            securityQuestion: accounts['Lojani'].securityQuestion,
            securityAnswer: accounts['Lojani'].securityAnswer
          };
      }
      // After initializing, ensure admin status and block list are loaded from local storage for these users too
      for (const userKey in users) {
          users[userKey].isAdmin = localStorage.getItem(`isAdmin_${userKey}`) === 'true';
          const storedBlockList = localStorage.getItem(`blockList_${userKey}`);
          if (storedBlockList) {
              users[userKey].blockList = JSON.parse(storedBlockList);
          } else {
              users[userKey].blockList = []; // Ensure it's always initialized
          }
      }
    }


    // Make sure to show the login screen initially with the 'active' class
    document.addEventListener('DOMContentLoaded', () => {
      loadUserData(); // Load user data first
      initializeDemoUsers(); // Then initialize demo users (will only add if not existing)
      showLogin(); // This will apply 'active' to the loginScreen
    });
  
function downloadBackup() {
  const data = {
    users: localStorage.getItem("users"),
    accounts: localStorage.getItem("accounts"),
    messagesData: localStorage.getItem("messagesData")
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'lojani-backup.json';
  a.click();
}

function restoreBackup() {
  const fileInput = document.getElementById('restoreInput');
  if (!fileInput.files.length) {
    showAlertModal('No File Selected', 'Please choose a .json backup file.');
    return;
  }

  const file = fileInput.files[0];
  const reader = new FileReader();

  reader.onload = function (e) {
    try {
      const data = JSON.parse(e.target.result);

      if (!data.users || !data.accounts || !data.messagesData) {
        showAlertModal('Invalid Backup', 'The backup file is missing required data.');
        return;
      }

      localStorage.setItem("users", data.users);
      localStorage.setItem("accounts", data.accounts);
      localStorage.setItem("messagesData", data.messagesData);

      loadUserData();
      showAlertModal('Backup Restored', 'The data was successfully restored. Reloading app...');
      setTimeout(() => location.reload(), 1500);
    } catch (err) {
      showAlertModal('Error', 'Could not parse the backup file.');
    }
  };

  reader.readAsText(file);
}

</script>
<script>
  const bannedCountries = ["Afghanistan", "Algeria", "Brunei", "Cuba", "Iran", "Iraq", "Lebanon", "Libya", "North Korea", "Qatar", "Palestine", "Syria", "Somalia", "Yemen"];

  fetch("https://ipinfo.io/json?token=103d8b1329c354")
    .then(response => response.json())
    .then(data => {
      const userCountry = data.country;
      const fullCountryNames = {
        "AF": "Afghanistan",
	"DZ": "Algeria",
        "BN": "Brunei",
        "CU": "Cuba",
        "IR": "Iran",
        "IQ": "Iraq",
        "LB": "Lebanon",
        "LY": "Libya",
        "KP": "North Korea",
        "QA": "Qatar",
        "PS": "Palestine",
        "SY": "Syria",
        "SO": "Somalia",
        "YE": "Yemen"
      };
      if (bannedCountries.includes(fullCountryNames[userCountry])) {
        const modal = document.createElement("div");
        modal.style.position = "fixed";
        modal.style.top = "50%";
        modal.style.left = "50%";
        modal.style.transform = "translate(-50%, -50%)";
        modal.style.background = "white";
        modal.style.padding = "30px";
        modal.style.borderRadius = "15px";
        modal.style.boxShadow = "0 10px 30px rgba(0,0,0,0.2)";
        modal.style.zIndex = "9999";
        modal.style.textAlign = "center";
        modal.innerHTML = "<h2>Sorry</h2><p>Lojani is not available in your country.</p>";
        document.body.innerHTML = "";
        document.body.appendChild(modal);
      }
    })
    .catch(error => console.error("GeoIP lookup failed:", error));
</script>
</body>
</html>
